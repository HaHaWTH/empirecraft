From df5692693226ee25e493dc1e5420f2f20172a1bc Mon Sep 17 00:00:00 2001
From: Aikar <aikar@aikar.co>
Date: Tue, 1 Apr 2014 01:34:02 -0400
Subject: [PATCH] Use CLQ for timings

---
 src/main/java/org/spigotmc/CustomTimingsHandler.java | 10 +++++++---
 1 file changed, 7 insertions(+), 3 deletions(-)

diff --git a/src/main/java/org/spigotmc/CustomTimingsHandler.java b/src/main/java/org/spigotmc/CustomTimingsHandler.java
index f62fe47..33c5cc1 100644
--- a/src/main/java/org/spigotmc/CustomTimingsHandler.java
+++ b/src/main/java/org/spigotmc/CustomTimingsHandler.java
@@ -8,6 +8,10 @@ import org.bukkit.plugin.TimedRegisteredListener;
 import java.io.PrintStream;
 import java.util.Collection;
 import java.util.HashSet;
+import java.util.List;
+import java.util.Queue;
+import java.util.concurrent.ConcurrentLinkedQueue;
+
 import org.bukkit.Bukkit;
 import org.bukkit.World;
 
@@ -18,7 +22,7 @@ public class CustomTimingsHandler
 {
 
     private static final Collection<CustomTimingsHandler> ALL_HANDLERS = new HashSet<CustomTimingsHandler>();
-    private static CustomTimingsHandler[] BAKED_HANDLERS;
+    private static Queue<CustomTimingsHandler> BAKED_HANDLERS = new ConcurrentLinkedQueue<CustomTimingsHandler>(); // EMC
     /*========================================================================*/
     private final String name;
     private final CustomTimingsHandler parent;
@@ -38,8 +42,8 @@ public class CustomTimingsHandler
     {
         this.name = name;
         this.parent = parent;
-        ALL_HANDLERS.add( this );
-        BAKED_HANDLERS = ALL_HANDLERS.toArray( new CustomTimingsHandler[ ALL_HANDLERS.size() ] );
+        BAKED_HANDLERS.add( this ); // EMC
+        //BAKED_HANDLERS = ALL_HANDLERS.toArray( new CustomTimingsHandler[ ALL_HANDLERS.size() ] ); // EMC
     }
 
     /**
-- 
1.8.3.2


From bbb76d3079d8ea782553d1f5cff0439c9385a05f Mon Sep 17 00:00:00 2001
From: Aikar <aikar@aikar.co>
Date: Fri, 27 Mar 2020 17:54:28 -0400
Subject: [PATCH] Fix incorrect flushing of IO Queue for non flush saves

---
 src/main/java/net/minecraft/server/PlayerChunkMap.java | 3 +--
 1 file changed, 1 insertion(+), 2 deletions(-)

diff --git a/src/main/java/net/minecraft/server/PlayerChunkMap.java b/src/main/java/net/minecraft/server/PlayerChunkMap.java
index 47520f4858..d3c376ba5c 100644
--- a/src/main/java/net/minecraft/server/PlayerChunkMap.java
+++ b/src/main/java/net/minecraft/server/PlayerChunkMap.java
@@ -469,8 +469,7 @@ public class PlayerChunkMap extends IChunkLoader implements PlayerChunk.d {
             this.b(() -> {
                 return true;
             });
-            this.world.asyncChunkTaskManager.flush(); // Paper - flush to preserve behavior compat with pre-async behaviour
-//            this.i(); // Paper - nuke IOWorker
+            this.world.asyncChunkTaskManager.flush(); // Paper - flag = flush and block until saved to disk for /save-all flush and shutdown
             PlayerChunkMap.LOGGER.info("ThreadedAnvilChunkStorage ({}): All chunks are saved", this.w.getName());
         } else {
             this.visibleChunks.values().stream().filter(PlayerChunk::hasBeenLoaded).forEach((playerchunk) -> {
-- 
2.25.1


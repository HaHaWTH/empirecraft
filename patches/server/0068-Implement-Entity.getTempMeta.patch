From d6f967e5ba2566d88a2fa5b7d4fd2eec87b685ea Mon Sep 17 00:00:00 2001
From: Aikar <aikar@aikar.co>
Date: Sun, 14 Jun 2015 10:59:04 -0400
Subject: [PATCH] Implement Entity.getTempMeta

---
 src/main/java/org/bukkit/craftbukkit/CraftServer.java        | 7 +++++++
 src/main/java/org/bukkit/craftbukkit/entity/CraftEntity.java | 2 ++
 2 files changed, 9 insertions(+)

diff --git a/src/main/java/org/bukkit/craftbukkit/CraftServer.java b/src/main/java/org/bukkit/craftbukkit/CraftServer.java
index bd42d9ead..ea1dc8f7f 100644
--- a/src/main/java/org/bukkit/craftbukkit/CraftServer.java
+++ b/src/main/java/org/bukkit/craftbukkit/CraftServer.java
@@ -783,6 +783,13 @@ public final class CraftServer implements Server {
                 "This plugin is not properly shutting down its async tasks when it is being reloaded.  This may cause conflicts with the newly loaded version of the plugin"
             ));
         }
+        // EMC start
+        for (World world : Bukkit.getWorlds()) {
+            for (org.bukkit.entity.Entity entity : world.getEntities()) {
+                entity.getTempMeta().clear();
+            }
+        }
+        // EMC end
         net.minecraft.server.EntityTasksHandler.reload(); // EMC
         loadPlugins();
         enablePlugins(PluginLoadOrder.STARTUP);
diff --git a/src/main/java/org/bukkit/craftbukkit/entity/CraftEntity.java b/src/main/java/org/bukkit/craftbukkit/entity/CraftEntity.java
index bcaad69cf..96615a8af 100644
--- a/src/main/java/org/bukkit/craftbukkit/entity/CraftEntity.java
+++ b/src/main/java/org/bukkit/craftbukkit/entity/CraftEntity.java
@@ -25,6 +25,8 @@ import org.bukkit.plugin.Plugin;
 import org.bukkit.util.Vector;
 
 public abstract class CraftEntity implements org.bukkit.entity.Entity {
+    private final java.util.Map<String, Object> tempMeta = com.google.common.collect.Maps.newHashMapWithExpectedSize(0); // EMC
+    public java.util.Map<String, Object> getTempMeta() { return tempMeta; } // EMC
     private static PermissibleBase perm;
 
     protected final CraftServer server;
-- 
2.11.0


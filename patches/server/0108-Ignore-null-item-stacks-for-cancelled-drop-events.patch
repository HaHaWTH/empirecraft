From ec4be787b8c9c8011eb734a2f8129c6ea2cfd035 Mon Sep 17 00:00:00 2001
From: Aikar <aikar@aikar.co>
Date: Thu, 23 Jun 2016 23:24:20 -0400
Subject: [PATCH] Ignore null item stacks for cancelled drop events

---
 src/main/java/net/minecraft/server/EntityHuman.java | 1 +
 1 file changed, 1 insertion(+)

diff --git a/src/main/java/net/minecraft/server/EntityHuman.java b/src/main/java/net/minecraft/server/EntityHuman.java
index f0332ad..897436e 100644
--- a/src/main/java/net/minecraft/server/EntityHuman.java
+++ b/src/main/java/net/minecraft/server/EntityHuman.java
@@ -575,6 +575,7 @@ public abstract class EntityHuman extends EntityLiving {
             this.world.getServer().getPluginManager().callEvent(event);
 
             if (event.isCancelled()) {
+                if (event.getItemDrop().getItemStack() == null) { return null; } // EMC
                 org.bukkit.inventory.ItemStack cur = player.getInventory().getItemInHand();
                 if (flag1 && (cur == null || cur.getAmount() == 0)) {
                     // The complete stack was dropped
-- 
2.9.0


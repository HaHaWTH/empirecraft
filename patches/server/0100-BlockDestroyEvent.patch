From fe2e3e5e2af6484d22a5c38cc0c9e610d086fd44 Mon Sep 17 00:00:00 2001
From: Aikar <aikar@aikar.co>
Date: Wed, 6 Feb 2019 00:20:33 -0500
Subject: [PATCH] BlockDestroyEvent

Adds an event for when the server is going to destroy a current block,
potentially causing it to drop. This event can be cancelled to avoid
the block destruction, such as preventing signs from popping when
floating in the air.

This can replace many uses of BlockPhysicsEvent
---
 src/main/java/net/minecraft/server/World.java | 10 +++++++++-
 1 file changed, 9 insertions(+), 1 deletion(-)

diff --git a/src/main/java/net/minecraft/server/World.java b/src/main/java/net/minecraft/server/World.java
index c0c65dc64b..d1a086f3cb 100644
--- a/src/main/java/net/minecraft/server/World.java
+++ b/src/main/java/net/minecraft/server/World.java
@@ -549,8 +549,16 @@ public abstract class World implements IEntityAccess, GeneratorAccess, IIBlockAc
             return false;
         } else {
             Fluid fluid = this.getFluid(blockposition);
+            // Paper start - while the above setAir method is named same and looks very similar
+            // they are NOT used with same intent and the above should not fire this event. The above method is more of a BlockSetToAirEvent,
+            // it doesn't imply destruction of a block that plays a sound effect / drops an item.
+            com.destroystokyo.paper.event.block.BlockDestroyEvent event = new com.destroystokyo.paper.event.block.BlockDestroyEvent(MCUtil.toBukkitBlock(this, blockposition), fluid.i().createCraftBlockData(), flag);
+            if (!event.callEvent()) {
+                return false;
+            }
+            // Paper end
 
-            this.triggerEffect(2001, blockposition, Block.getCombinedId(iblockdata));
+            if (event.playEffect()) this.triggerEffect(2001, blockposition, Block.getCombinedId(iblockdata)); // Paper
             if (flag) {
                 iblockdata.a(this, blockposition, 0);
             }
-- 
2.20.1


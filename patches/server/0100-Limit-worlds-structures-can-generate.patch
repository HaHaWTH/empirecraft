From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Aikar <aikar@aikar.co>
Date: Wed, 6 May 2015 02:29:30 -0400
Subject: [PATCH] Limit worlds structures can generate

---
 src/main/java/net/minecraft/server/level/WorldServer.java      | 2 +-
 src/main/java/net/minecraft/world/level/StructureManager.java  | 2 +-
 src/main/java/net/minecraft/world/level/chunk/ChunkStatus.java | 2 +-
 3 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/src/main/java/net/minecraft/server/level/WorldServer.java b/src/main/java/net/minecraft/server/level/WorldServer.java
index 0648dc02ff90e9487996bd2ab67a1378a72bbfd0..2a8534083b6d11f8ddf42b09b5555d8cae30d6f8 100644
--- a/src/main/java/net/minecraft/server/level/WorldServer.java
+++ b/src/main/java/net/minecraft/server/level/WorldServer.java
@@ -1872,7 +1872,7 @@ public class WorldServer extends World implements GeneratorAccessSeed {
 
     @Nullable
     public BlockPosition a(StructureGenerator<?> structuregenerator, BlockPosition blockposition, int i, boolean flag) {
-        return !this.worldDataServer.getGeneratorSettings().shouldGenerateMapFeatures() ? null : this.getChunkProvider().getChunkGenerator().findNearestMapFeature(this, structuregenerator, blockposition, i, flag); // CraftBukkit
+        return !this.worldDataServer.getGeneratorSettings().shouldGenerateMapFeatures() || "town".equals(getWorld().getName()) ? null : this.getChunkProvider().getChunkGenerator().findNearestMapFeature(this, structuregenerator, blockposition, i, flag); // CraftBukkit // EMC
     }
 
     @Nullable
diff --git a/src/main/java/net/minecraft/world/level/StructureManager.java b/src/main/java/net/minecraft/world/level/StructureManager.java
index 07dcfd56af1014ad159828dd9ee2d89c2010b9f4..25b62975a5e7cdc0b9f1ba231aa004cecc21eb01 100644
--- a/src/main/java/net/minecraft/world/level/StructureManager.java
+++ b/src/main/java/net/minecraft/world/level/StructureManager.java
@@ -72,7 +72,7 @@ public class StructureManager {
     }
 
     public boolean a() {
-        return this.b.shouldGenerateMapFeatures();
+        return this.b.shouldGenerateMapFeatures() && !"town".equals(getWorld().getWorld().getName()); // EMC
     }
 
     public StructureStart<?> a(BlockPosition blockposition, boolean flag, StructureGenerator<?> structuregenerator) {
diff --git a/src/main/java/net/minecraft/world/level/chunk/ChunkStatus.java b/src/main/java/net/minecraft/world/level/chunk/ChunkStatus.java
index f094ddf6b4d155f3c7a08a3b811c98b0862fd098..27b660c2f1bc6e19345b0e9f60700327ee73a58d 100644
--- a/src/main/java/net/minecraft/world/level/chunk/ChunkStatus.java
+++ b/src/main/java/net/minecraft/world/level/chunk/ChunkStatus.java
@@ -38,7 +38,7 @@ public class ChunkStatus {
     });
     public static final ChunkStatus STRUCTURE_STARTS = a("structure_starts", ChunkStatus.EMPTY, 0, ChunkStatus.n, ChunkStatus.Type.PROTOCHUNK, (chunkstatus, worldserver, chunkgenerator, definedstructuremanager, lightenginethreaded, function, list, ichunkaccess) -> {
         if (!ichunkaccess.getChunkStatus().b(chunkstatus)) {
-            if (worldserver.worldDataServer.getGeneratorSettings().shouldGenerateMapFeatures()) { // CraftBukkit
+            if (worldserver.worldDataServer.getGeneratorSettings().shouldGenerateMapFeatures() && !"town".equals(worldserver.getWorld().getName())) { // CraftBukkit // EMC
                 chunkgenerator.createStructures(worldserver.r(), worldserver.getStructureManager(), ichunkaccess, definedstructuremanager, worldserver.getSeed());
             }
 

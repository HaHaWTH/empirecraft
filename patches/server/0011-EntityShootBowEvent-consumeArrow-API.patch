From c67b7723cc704319526db7f772da26a7b5f2bf95 Mon Sep 17 00:00:00 2001
From: Aikar <aikar@aikar.co>
Date: Sat, 15 Jun 2013 19:51:17 -0400
Subject: [PATCH] EntityShootBowEvent consumeArrow API

---
 src/main/java/net/minecraft/server/ItemBow.java | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/src/main/java/net/minecraft/server/ItemBow.java b/src/main/java/net/minecraft/server/ItemBow.java
index 867705b..c879fba 100644
--- a/src/main/java/net/minecraft/server/ItemBow.java
+++ b/src/main/java/net/minecraft/server/ItemBow.java
@@ -54,6 +54,7 @@ public class ItemBow extends Item {
                 if ((double) f >= 0.1D) {
                     boolean flag1 = flag && itemstack1.getItem() == Items.ARROW;
 
+                    boolean consumeArrow = true; // EMC
                     if (!world.isClientSide) {
                         ItemArrow itemarrow = (ItemArrow) ((ItemArrow) (itemstack1.getItem() instanceof ItemArrow ? itemstack1.getItem() : Items.ARROW));
                         EntityArrow entityarrow = itemarrow.a(world, itemstack1, entityhuman);
@@ -105,11 +106,12 @@ public class ItemBow extends Item {
                                 return;
                             }
                         }
+                        consumeArrow = event.getConsumeArrow(); // EMC
                         // CraftBukkit end
                     }
 
                     world.a((EntityHuman) null, entityhuman.locX, entityhuman.locY, entityhuman.locZ, SoundEffects.v, SoundCategory.NEUTRAL, 1.0F, 1.0F / (ItemBow.j.nextFloat() * 0.4F + 1.2F) + f * 0.5F);
-                    if (!flag1) {
+                    if (!flag1 && consumeArrow) { // EMC
                         --itemstack1.count;
                         if (itemstack1.count == 0) {
                             entityhuman.inventory.d(itemstack1);
-- 
2.8.2


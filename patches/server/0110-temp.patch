From 323473417e97b84ccae11ebdae6f09efd20d0e2d Mon Sep 17 00:00:00 2001
From: chickeneer <emcchickeneer@gmail.com>
Date: Tue, 17 Mar 2020 14:18:50 -0500
Subject: [PATCH] temp

---
 src/main/java/net/minecraft/server/EntityBee.java | 12 +++++++++++-
 1 file changed, 11 insertions(+), 1 deletion(-)

diff --git a/src/main/java/net/minecraft/server/EntityBee.java b/src/main/java/net/minecraft/server/EntityBee.java
index bd1f258629..15590ee887 100644
--- a/src/main/java/net/minecraft/server/EntityBee.java
+++ b/src/main/java/net/minecraft/server/EntityBee.java
@@ -315,6 +315,7 @@ public class EntityBee extends EntityAnimal implements EntityBird {
         if (this.hivePos == null) {
             return false;
         } else {
+            if (!isPosLoaded(hivePos)) return false; // EMC
             TileEntity tileentity = this.world.getTileEntity(this.hivePos);
 
             return tileentity instanceof TileEntityBeehive && ((TileEntityBeehive) tileentity).d();
@@ -332,8 +333,15 @@ public class EntityBee extends EntityAnimal implements EntityBird {
     public void setAnger(int i) {
         this.datawatcher.set(EntityBee.bx, i);
     }
-
+    // EMC start
+    private boolean isPosLoaded(BlockPosition pos) {
+        return pos != null && world.getChunkIfLoadedImmediately(pos.getX() >> 4, pos.getZ() >> 4) != null;
+    }
     private boolean i(BlockPosition blockposition) {
+        if (!isPosLoaded(blockposition)) {
+            return false;
+        }
+        // EMC end
         TileEntity tileentity = this.world.getTileEntity(blockposition);
 
         return tileentity instanceof TileEntityBeehive ? !((TileEntityBeehive) tileentity).isFull() : false;
@@ -600,6 +608,7 @@ public class EntityBee extends EntityAnimal implements EntityBird {
         @Override
         public boolean g() {
             if (EntityBee.this.hasHivePos() && EntityBee.this.eI() && EntityBee.this.hivePos.a((IPosition) EntityBee.this.getPositionVector(), 2.0D)) {
+                if (!isPosLoaded(EntityBee.this.hivePos)) return false; // EMC
                 TileEntity tileentity = EntityBee.this.world.getTileEntity(EntityBee.this.hivePos);
 
                 if (tileentity instanceof TileEntityBeehive) {
@@ -623,6 +632,7 @@ public class EntityBee extends EntityAnimal implements EntityBird {
 
         @Override
         public void c() {
+            if (!isPosLoaded(EntityBee.this.hivePos)) return; // EMC
             TileEntity tileentity = EntityBee.this.world.getTileEntity(EntityBee.this.hivePos);
 
             if (tileentity instanceof TileEntityBeehive) {
-- 
2.25.1


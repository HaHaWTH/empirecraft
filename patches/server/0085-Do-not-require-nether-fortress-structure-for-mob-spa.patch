From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: chickeneer <emcchickeneer@gmail.com>
Date: Sun, 17 May 2020 15:40:10 -0500
Subject: [PATCH] Do not require nether fortress structure for mob spawning

Due to failed fortress conversions - some structure data is missing.
This allows players to make their own fortress with nether bricks

diff --git a/src/main/java/net/minecraft/world/level/NaturalSpawner.java b/src/main/java/net/minecraft/world/level/NaturalSpawner.java
index d87900e2a9559a34ee66e3cffab851a578c0278e..8f5e4196b44d6ea9821f420c299707326dcfddaf 100644
--- a/src/main/java/net/minecraft/world/level/NaturalSpawner.java
+++ b/src/main/java/net/minecraft/world/level/NaturalSpawner.java
@@ -49,6 +49,7 @@ import net.minecraft.world.phys.Vec3;
 import org.slf4j.Logger;
 import org.bukkit.craftbukkit.util.CraftSpawnCategory;
 import org.bukkit.entity.SpawnCategory;
+import org.bukkit.World;
 import org.bukkit.event.entity.CreatureSpawnEvent.SpawnReason;
 // CraftBukkit end
 
@@ -405,6 +406,11 @@ public final class NaturalSpawner {
 
     public static boolean isInNetherFortressBounds(BlockPos pos, ServerLevel world, MobCategory spawnGroup, StructureFeatureManager structureAccessor) {
         if (spawnGroup == MobCategory.MONSTER && world.getBlockState(pos.below()).is(Blocks.NETHER_BRICKS)) {
+            // EMC start - add nether check and skip structure requirement
+            if (world.getWorld().getEnvironment() == World.Environment.NETHER) {
+                return true;
+            }
+            // EMC end
             ConfiguredStructureFeature<?, ?> structurefeature = (ConfiguredStructureFeature) structureAccessor.registryAccess().registryOrThrow(Registry.CONFIGURED_STRUCTURE_FEATURE_REGISTRY).get(BuiltinStructures.FORTRESS);
 
             return structurefeature == null ? false : structureAccessor.getStructureAt(pos, structurefeature).isValid();

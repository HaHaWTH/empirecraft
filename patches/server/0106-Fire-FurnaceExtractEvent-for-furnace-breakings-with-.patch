From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: chickeneer <emcchickeneer@gmail.com>
Date: Wed, 2 Jun 2021 09:16:37 -0500
Subject: [PATCH] Fire FurnaceExtractEvent for furnace breakings with null
 players

temp
---
 .../world/level/block/entity/TileEntityFurnace.java       | 8 ++++----
 1 file changed, 4 insertions(+), 4 deletions(-)

diff --git a/src/main/java/net/minecraft/world/level/block/entity/TileEntityFurnace.java b/src/main/java/net/minecraft/world/level/block/entity/TileEntityFurnace.java
index 9ce19b89c16eb6edd3d5d5cc87a966a37f66895c..4cc24db9606a8dd6a90a6246ebfc0b16e7072f8c 100644
--- a/src/main/java/net/minecraft/world/level/block/entity/TileEntityFurnace.java
+++ b/src/main/java/net/minecraft/world/level/block/entity/TileEntityFurnace.java
@@ -600,14 +600,14 @@ public abstract class TileEntityFurnace extends TileEntityContainer implements I
 
             world.getCraftingManager().getRecipe((MinecraftKey) entry.getKey()).ifPresent((irecipe) -> {
                 list.add(irecipe);
-                a(world, vec3d, entry.getIntValue(), ((RecipeCooking) irecipe).getExperience(), entityhuman, itemstack, amount); // CraftBukkit
+                a(world, vec3d, entry.getIntValue(), ((RecipeCooking) irecipe).getExperience(), entityhuman, itemstack, amount, irecipe.getResult()); // CraftBukkit // EMC - add result item
             });
         }
 
         return list;
     }
 
-    private void a(World world, Vec3D vec3d, int i, float f, EntityHuman entityhuman, ItemStack itemstack, int amount) { // CraftBukkit
+    private void a(World world, Vec3D vec3d, int i, float f, EntityHuman entityhuman, ItemStack itemstack, int amount, ItemStack result) { // CraftBukkit // EMC - add result item
         int j = MathHelper.d((float) i * f);
         float f1 = MathHelper.h((float) i * f);
 
@@ -616,8 +616,8 @@ public abstract class TileEntityFurnace extends TileEntityContainer implements I
         }
 
         // CraftBukkit start - fire FurnaceExtractEvent
-        if (amount != 0) {
-            FurnaceExtractEvent event = new FurnaceExtractEvent((Player) entityhuman.getBukkitEntity(), CraftBlock.at(world, position), org.bukkit.craftbukkit.util.CraftMagicNumbers.getMaterial(itemstack.getItem()), amount, j);
+        if (true || amount != 0) { // EMC
+            FurnaceExtractEvent event = new FurnaceExtractEvent(entityhuman == null ? null : (Player) entityhuman.getBukkitEntity(), CraftBlock.at(world, position), itemstack == null ? null : org.bukkit.craftbukkit.util.CraftMagicNumbers.getMaterial(itemstack.getItem()), amount, j, org.bukkit.craftbukkit.util.CraftMagicNumbers.getMaterial(result.getItem()), i); // EMC - add == null for entityhuman and itemstack and add resultType/resultAmount
             world.getServer().getPluginManager().callEvent(event);
             j = event.getExpToDrop();
         }

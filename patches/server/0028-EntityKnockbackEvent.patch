From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Aikar <aikar@aikar.co>
Date: Sun, 16 Mar 2014 20:44:46 -0400
Subject: [PATCH] EntityKnockbackEvent

Control knockback power of entity attacks
---
 .../net/minecraft/world/entity/EntityInsentient.java     | 2 +-
 .../net/minecraft/world/entity/player/EntityHuman.java   | 2 +-
 .../world/item/enchantment/EnchantmentManager.java       | 9 +++++++--
 3 files changed, 9 insertions(+), 4 deletions(-)

diff --git a/src/main/java/net/minecraft/world/entity/EntityInsentient.java b/src/main/java/net/minecraft/world/entity/EntityInsentient.java
index d28413aae5da85103f63a331b43b2e70e155d7d2..9d1db4c64d32a903af57a1fe30176643c7cd65cd 100644
--- a/src/main/java/net/minecraft/world/entity/EntityInsentient.java
+++ b/src/main/java/net/minecraft/world/entity/EntityInsentient.java
@@ -1576,7 +1576,7 @@ public abstract class EntityInsentient extends EntityLiving {
 
         if (entity instanceof EntityLiving) {
             f += EnchantmentManager.a(this.getItemInMainHand(), ((EntityLiving) entity).getMonsterType());
-            f1 += (float) EnchantmentManager.b((EntityLiving) this);
+            f1 += EnchantmentManager.getKnockbackEnchantmentLevel(this, (EntityLiving) entity); // EMC
         }
 
         int i = EnchantmentManager.getFireAspectEnchantmentLevel(this);
diff --git a/src/main/java/net/minecraft/world/entity/player/EntityHuman.java b/src/main/java/net/minecraft/world/entity/player/EntityHuman.java
index cfa0518e55b93fb3de511f30011475d665d8ffb1..efa4b0a3a20e5c209a6df519c91b726a5216dd33 100644
--- a/src/main/java/net/minecraft/world/entity/player/EntityHuman.java
+++ b/src/main/java/net/minecraft/world/entity/player/EntityHuman.java
@@ -1147,7 +1147,7 @@ public abstract class EntityHuman extends EntityLiving {
                     boolean flag = f2 > 0.9F;
                     boolean flag1 = false;
                     byte b0 = 0;
-                    int i = b0 + EnchantmentManager.b((EntityLiving) this);
+                    int i = b0 + EnchantmentManager.getKnockbackEnchantmentLevel(this, entity instanceof EntityLiving ? (EntityLiving) entity : null); // EMC
 
                     if (this.isSprinting() && flag) {
                         sendSoundEffect(this, this.locX(), this.locY(), this.locZ(), SoundEffects.ENTITY_PLAYER_ATTACK_KNOCKBACK, this.getSoundCategory(), 1.0F, 1.0F); // Paper - send while respecting visibility
diff --git a/src/main/java/net/minecraft/world/item/enchantment/EnchantmentManager.java b/src/main/java/net/minecraft/world/item/enchantment/EnchantmentManager.java
index 72afbf8f537770540e90a2880ea81de137ea10f5..5880c8893b336e1781284346bfb04915369a4800 100644
--- a/src/main/java/net/minecraft/world/item/enchantment/EnchantmentManager.java
+++ b/src/main/java/net/minecraft/world/item/enchantment/EnchantmentManager.java
@@ -205,8 +205,13 @@ public class EnchantmentManager {
         }
     }
 
-    public static int b(EntityLiving entityliving) {
-        return a(Enchantments.KNOCKBACK, entityliving);
+    // EMC start - rename and add target
+    public static int getKnockbackEnchantmentLevel(EntityLiving entityliving, EntityLiving target) { // EMC - OBF HELPER
+        int level = a(Enchantments.KNOCKBACK, entityliving);
+        com.empireminecraft.customevents.EntityKnockbackEvent event = new com.empireminecraft.customevents.EntityKnockbackEvent((org.bukkit.entity.LivingEntity) entityliving.getBukkitEntity(), target != null ? (org.bukkit.entity.LivingEntity) target.getBukkitEntity() : null, level);
+        event.callEvent();
+        return event.getLevel();
+        // EMC end
     }
 
     public static int getFireAspectEnchantmentLevel(EntityLiving entityliving) {

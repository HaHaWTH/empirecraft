From 5b5be10e8afd038ab90a132e6db08573a3b49a42 Mon Sep 17 00:00:00 2001
From: Aikar <aikar@aikar.co>
Date: Fri, 6 Dec 2013 20:54:23 -0500
Subject: [PATCH] AchievementBroadcastEvent

Used to control who sees achievement message
---
 .../java/net/minecraft/server/ServerStatisticManager.java  | 14 +++++++++++++-
 1 file changed, 13 insertions(+), 1 deletion(-)

diff --git a/src/main/java/net/minecraft/server/ServerStatisticManager.java b/src/main/java/net/minecraft/server/ServerStatisticManager.java
index d1bee0257f..2ebe857721 100644
--- a/src/main/java/net/minecraft/server/ServerStatisticManager.java
+++ b/src/main/java/net/minecraft/server/ServerStatisticManager.java
@@ -1,5 +1,6 @@
 package net.minecraft.server;
 
+import com.empireminecraft.customevents.AchievementBroadcastEvent;
 import com.google.common.collect.Maps;
 import com.google.common.collect.Sets;
 import com.google.gson.JsonElement;
@@ -18,6 +19,8 @@ import java.util.Map.Entry;
 import org.apache.commons.io.FileUtils;
 import org.apache.logging.log4j.LogManager;
 import org.apache.logging.log4j.Logger;
+import org.bukkit.craftbukkit.entity.CraftPlayer;
+import org.bukkit.entity.Player;
 
 public class ServerStatisticManager extends StatisticManager {
 
@@ -74,7 +77,16 @@ public class ServerStatisticManager extends StatisticManager {
         if (statistic.d() && j == 0 && i > 0) {
             this.g = true;
             if (this.c.ay()) {
-                this.c.getPlayerList().sendMessage(new ChatMessage("chat.type.achievement", new Object[] { entityhuman.getScoreboardDisplayName(), statistic.j()}));
+                // EMC start
+                ChatMessage achv = new ChatMessage("chat.type.achievement", new Object[] { entityhuman.getScoreboardDisplayName(), statistic.j()});
+                com.empireminecraft.customevents.AchievementBroadcastEvent event = new AchievementBroadcastEvent(
+                    (Player) entityhuman.getBukkitEntity());
+                event.callEvent();
+                for (Player player : event.getReceivers()) {
+                    ((CraftPlayer) player).getHandle().sendMessage(achv);
+                }
+                //this.c.getPlayerList().sendMessage(new ChatMessage("chat.type.achievement", new Object[] { entityhuman.getScoreboardDisplayName(), statistic.j()}));
+                // EMC end
             }
         }
 
-- 
2.11.0


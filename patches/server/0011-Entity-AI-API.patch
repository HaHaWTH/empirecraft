From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Aikar <aikar@aikar.co>
Date: Tue, 6 Dec 2016 22:22:14 -0500
Subject: [PATCH] Entity AI API

---
 .../empireminecraft/api/CraftEAPI_Entity.java | 130 ++++++++
 .../com/empireminecraft/api/EntityAIApi.java  | 315 ++++++++++++++++++
 .../minecraft/server/EntityGoalAccessor.java  |  30 ++
 .../minecraft/server/level/WorldServer.java   |   3 +-
 .../net/minecraft/world/entity/Entity.java    |  20 +-
 .../world/entity/EntityCreature.java          |   1 +
 .../world/entity/EntityInsentient.java        |   1 +
 .../minecraft/world/entity/EntityLiving.java  |  28 +-
 .../ai/goal/PathfinderGoalArrowAttack.java    | 103 ++++++
 .../ai/goal/PathfinderGoalBowShoot.java       | 135 ++++++++
 .../entity/ai/goal/PathfinderGoalFleeSun.java |  72 ++++
 .../ai/goal/PathfinderGoalMeleeAttack.java    | 139 ++++++++
 .../entity/ai/goal/PathfinderGoalPanic.java   |   3 +-
 .../ai/goal/PathfinderGoalSelector.java       |   3 +-
 .../ai/goal/target/PathfinderGoalTarget.java  |   1 +
 .../world/entity/animal/EntityAnimal.java     |   2 +-
 .../world/entity/animal/EntityWolf.java       |   7 +
 .../world/entity/item/EntityItem.java         |   3 +-
 .../world/entity/monster/EntityBlaze.java     | 281 ++++++++++++++++
 .../world/entity/monster/EntityGhast.java     |   3 +-
 .../world/entity/monster/EntitySpider.java    |   4 +
 .../entity/projectile/EntityEnderSignal.java  |  20 +-
 .../bukkit/craftbukkit/entity/CraftBlaze.java |  18 +
 .../craftbukkit/entity/CraftEnderSignal.java  |   3 +-
 .../bukkit/craftbukkit/entity/CraftGhast.java |   9 +
 .../java/org/spigotmc/ActivationRange.java    |   1 +
 26 files changed, 1319 insertions(+), 16 deletions(-)
 create mode 100644 src/main/java/com/empireminecraft/api/EntityAIApi.java
 create mode 100644 src/main/java/net/minecraft/server/EntityGoalAccessor.java
 create mode 100644 src/main/java/net/minecraft/world/entity/ai/goal/PathfinderGoalArrowAttack.java
 create mode 100644 src/main/java/net/minecraft/world/entity/ai/goal/PathfinderGoalBowShoot.java
 create mode 100644 src/main/java/net/minecraft/world/entity/ai/goal/PathfinderGoalFleeSun.java
 create mode 100644 src/main/java/net/minecraft/world/entity/ai/goal/PathfinderGoalMeleeAttack.java
 create mode 100644 src/main/java/net/minecraft/world/entity/monster/EntityBlaze.java

diff --git a/src/main/java/com/empireminecraft/api/CraftEAPI_Entity.java b/src/main/java/com/empireminecraft/api/CraftEAPI_Entity.java
index bb6e5296a801f7053db72d9eb4d7b9becdb751f4..0e9e04ee407c9921421b9a9154364026eb26be22 100644
--- a/src/main/java/com/empireminecraft/api/CraftEAPI_Entity.java
+++ b/src/main/java/com/empireminecraft/api/CraftEAPI_Entity.java
@@ -23,9 +23,21 @@
 
 package com.empireminecraft.api;
 
+import com.destroystokyo.paper.entity.RangedEntity;
+import net.minecraft.world.entity.animal.EntityWolf;
+import org.bukkit.entity.Mob;
 import net.minecraft.server.EntityTasksHandler;
+import org.bukkit.Location;
 import org.bukkit.craftbukkit.entity.CraftEntity;
+import org.bukkit.craftbukkit.entity.CraftSpider;
+import org.bukkit.craftbukkit.entity.CraftWolf;
+import org.bukkit.entity.Animals;
+import org.bukkit.entity.Creature;
+import org.bukkit.entity.EnderSignal;
 import org.bukkit.entity.Entity;
+import org.bukkit.entity.Item;
+import org.bukkit.entity.Spider;
+import org.bukkit.entity.Wolf;
 
 public class CraftEAPI_Entity implements EAPI_Entity {
 
@@ -39,4 +51,122 @@ public class CraftEAPI_Entity implements EAPI_Entity {
     public void cancelTasks(Entity entity) {
         ((CraftEntity) entity).getHandle().entityTasks.clear();
     }
+
+    @Override
+    public boolean isEntityDisabled(Entity entity) {
+        return EntityAIApi.isEntityDisabled(entity);
+    }
+
+    @Override
+    public void setItemCanDespawn(Item item, boolean canDespawn) {
+        EntityAIApi.setItemCanDespawn(item, canDespawn);
+    }
+
+    @Override
+    public void setDisabledEntity(Entity entity, boolean disabled) {
+        EntityAIApi.setDisabledEntity(entity, disabled);
+    }
+
+    @Override
+    public int getLove(Animals animal) {
+        return EntityAIApi.getLove(animal);
+    }
+
+    @Override
+    public void setLove(Animals animal, int love) {
+        EntityAIApi.setLove(animal, love);
+    }
+
+    @Override
+    public void setFireProof(Mob entity, boolean flag) {
+        EntityAIApi.setFireProof(entity, flag);
+    }
+
+    @Override
+    public void setFirePanicProof(Mob entity, boolean flag) {
+        EntityAIApi.setFirePanicProof(entity, flag);
+    }
+
+    @Override
+    public void makeAggressive(Creature creature, float range) {
+        EntityAIApi.makeAggressive(creature, range);
+    }
+
+    @Override
+    public void makeAggressiveDuringDay(Spider spider, boolean attack) {
+        ((CraftSpider) spider).getHandle().attackDuringDay = attack;
+    }
+
+    @Override
+    public boolean isAggressive(Creature creature) {
+        return EntityAIApi.isAggressive(creature);
+    }
+
+    @Override
+    public void makePeaceful(Mob entity) {
+        EntityAIApi.makePeaceful(entity);
+    }
+
+    @Override
+    public void addGoalByName(Mob entity, String goalName, boolean isTargetGoal, int tickRate, Class<?>[] argClasses, Object... args) {
+        EntityAIApi.addGoalByName(entity, goalName, isTargetGoal, tickRate, argClasses, args);
+    }
+
+    @Override
+    public void removeGoalByName(Mob entity, String goalName) {
+        EntityAIApi.removeGoalByName(entity, goalName);
+    }
+
+    @Override
+    public void setEntitySize(Entity entity, float width, float height) {
+        EntityAIApi.setEntitySize(entity, width, height);
+    }
+
+    @Override
+    public void setTargetRange(Mob entity, Double range) {
+        EntityAIApi.setTargetRange(entity, range);
+    }
+
+    @Override
+    public void setRangedAttackDistance(RangedEntity monster, float range) {
+        EntityAIApi.setRangedAttackDistance(monster, range);
+    }
+
+    @Override
+    public void setRangedAttackSpeed(RangedEntity monster, Integer min, Integer max) {
+        EntityAIApi.setRangedAttackSpeed(monster, min, max);
+    }
+
+    @Override
+    public void setAlwaysAngry(Wolf wolf, boolean alwaysAngry) {
+        EntityWolf entity = ((CraftWolf) wolf).getHandle();
+        entity.alwaysAngry = alwaysAngry;
+        if (alwaysAngry) {
+            entity.anger();
+        }
+    }
+
+    @Override
+    public void respawnEntity(Entity entity) {
+        EntityAIApi.respawnEntity(entity);
+    }
+
+    @Override
+    public void setEnderSignalSpeed(EnderSignal enderSignal, double speed) {
+        EntityAIApi.setEnderSignalSpeed(enderSignal, speed);
+    }
+    public void setEnderSignalDestination(EnderSignal enderSignal, Location target) {
+        EntityAIApi.setEnderSignalDestination(enderSignal, target);
+    }
+
+    @Override
+    public void setEnderSignalLife(EnderSignal enderSignal, int lifeTime) {
+        EntityAIApi.setEnderSignalLife(enderSignal, lifeTime);
+    }
+
+    @Override
+    public int getEnderSignalLife(EnderSignal enderSignal) {
+        return EntityAIApi.getEnderSignalLife(enderSignal);
+    }
+
 }
diff --git a/src/main/java/com/empireminecraft/api/EntityAIApi.java b/src/main/java/com/empireminecraft/api/EntityAIApi.java
new file mode 100644
index 0000000000000000000000000000000000000000..1f0f20b48188db24bcbd6f6a5d02c47d65ffd8fb
--- /dev/null
+++ b/src/main/java/com/empireminecraft/api/EntityAIApi.java
@@ -0,0 +1,315 @@
+package com.empireminecraft.api;
+
+import com.destroystokyo.paper.entity.RangedEntity;
+import net.minecraft.server.EntityGoalAccessor;
+import net.minecraft.server.MCUtil;
+import net.minecraft.server.MinecraftServer;
+import net.minecraft.world.entity.Entity;
+import net.minecraft.world.entity.EntityCreature;
+import net.minecraft.world.entity.EntityInsentient;
+import net.minecraft.world.entity.EntityLiving;
+import net.minecraft.world.entity.ai.goal.PathfinderGoal;
+import net.minecraft.world.entity.ai.goal.PathfinderGoalArrowAttack;
+import net.minecraft.world.entity.ai.goal.PathfinderGoalBowShoot;
+import net.minecraft.world.entity.ai.goal.PathfinderGoalMeleeAttack;
+import net.minecraft.world.entity.ai.goal.PathfinderGoalWrapped;
+import net.minecraft.world.entity.ai.goal.target.PathfinderGoalNearestAttackableTarget;
+import net.minecraft.world.entity.item.EntityItem;
+import net.minecraft.world.entity.player.EntityHuman;
+import net.minecraft.world.entity.projectile.EntityEnderSignal;
+import net.minecraft.world.level.pathfinder.PathEntity;
+import net.minecraft.world.level.pathfinder.PathPoint;
+import org.bukkit.craftbukkit.CraftWorld;
+import org.bukkit.craftbukkit.entity.CraftAnimals;
+import org.bukkit.craftbukkit.entity.CraftCreature;
+import org.bukkit.craftbukkit.entity.CraftEnderSignal;
+import org.bukkit.craftbukkit.entity.CraftEntity;
+import org.bukkit.entity.Animals;
+import org.bukkit.entity.Creature;
+import org.bukkit.entity.EnderSignal;
+import org.bukkit.entity.LivingEntity;
+import org.bukkit.entity.Mob;
+import com.empireminecraft.api.meta.Meta;
+import com.empireminecraft.api.meta.MetaKey.PersistentKey;
+import org.bukkit.Location;
+import org.bukkit.entity.Item;
+
+import java.lang.reflect.Constructor;
+import java.util.ArrayList;
+import java.util.List;
+import java.util.Set;
+
+public final class EntityAIApi {
+
+    public static final PersistentKey ENTITY_AGGRESSIVE_RANGE_KEY = Meta.createPersistentKey("entityAggressiveRange");
+
+    private EntityAIApi() {
+    }
+
+
+    private static EntityInsentient getInsentientHandle(Mob entity) {
+        return (EntityInsentient) (((CraftEntity) entity).getHandle());
+    }
+    /**
+     * Is this entity blocked from ticking
+     * @param entity
+     * @return
+     */
+    public static boolean isEntityDisabled(org.bukkit.entity.Entity entity) {
+        return ((CraftEntity) entity).getHandle().isDisabled;
+    }
+    public static void setItemCanDespawn(Item item, boolean canDespawn) {
+        final Entity handle = ((CraftEntity) item).getHandle();
+        ((EntityItem) handle).canDespawn = canDespawn;
+    }
+
+    /**
+     * Disables Ticking on an Entity
+     * @param entity
+     * @param disabled
+     */
+    public static void setDisabledEntity(org.bukkit.entity.Entity entity, boolean disabled) {
+        ((CraftEntity) entity).getHandle().isDisabled = disabled;
+    }
+    public static int getLove(Animals animal) {
+        return ((CraftAnimals) animal).getHandle().getLove();
+    }
+    public static void setLove(Animals animal, int love) {
+        ((CraftAnimals) animal).getHandle().setLove(love);
+    }
+    public static void setFireProof(Mob entity, boolean flag) {
+        getInsentientHandle(entity).fireProof = flag;
+    }
+    public static void setFirePanicProof(Mob entity, boolean flag) {
+        getInsentientHandle(entity).firePanicProof = flag;
+    }
+
+
+    public static void processEntityAddToWorld(Entity entity) {
+        if (entity instanceof EntityCreature) {
+            Number range =
+                Meta.getEntityMeta(entity.getBukkitEntity(), ENTITY_AGGRESSIVE_RANGE_KEY);
+            if (range != null) {
+                makeAggressive((org.bukkit.entity.Creature) entity.getBukkitEntity(), range.floatValue());
+            }
+        }
+    }
+
+    public static boolean isAggressive(Creature creature) {
+        EntityCreature entity = ((CraftCreature) creature).getHandle();
+        return entity.markedAggressive;
+    }
+
+    public static void makeAggressive(Creature creature, float range) {
+        EntityCreature handle = ((CraftCreature)creature).getHandle();
+        if (!handle.markedAggressive) {
+            handle.goalSelector.addGoal(2, new PathfinderGoalMeleeAttack(handle, 1.0F, false));
+            handle.targetSelector.addGoal(2, new PathfinderGoalNearestAttackableTarget(handle, EntityHuman.class, true));
+            Meta.setEntityMeta(creature, ENTITY_AGGRESSIVE_RANGE_KEY, range);
+            setTargetRange(creature, (double) range);
+            handle.markedAggressive = true;
+        }
+    }
+
+    public static void makePeaceful(Mob entity) {
+        final EntityInsentient handle = getInsentientHandle(entity);
+
+        getGoalSets(handle).forEach(set -> set.removeIf(o -> {
+            return EntityGoalAccessor.isHostileGoal(o.getGoal());
+        }));
+    }
+
+    public static void removeGoalByName(Mob entity, String goalName) {
+        final EntityInsentient handle = getInsentientHandle(entity);
+        String nms = handle.getClass().getPackage().getName() + ".";
+        getGoalSets(handle).forEach(set -> set.removeIf(o -> {
+            return o.getGoal().getClass().getName().replaceAll(nms, "").equalsIgnoreCase(goalName);
+        }));
+    }
+
+    public static void addGoalByName(Mob entity, String goalName, boolean isTargetGoal, int tickRate, Class<?>[] argClasses, Object... args) {
+        final EntityInsentient handle = getInsentientHandle(entity);
+        String nms = handle.getClass().getPackage().getName();
+        String className = nms + "." + goalName;
+        try {
+            PathfinderGoal goal = getPathfinderGoal(handle, argClasses, className, args);
+            if (goal == null) {
+                MinecraftServer.LOGGER.error("Could not create goal for " + className);
+                return;
+            }
+            if (isTargetGoal) {
+                handle.targetSelector.addGoal(tickRate, goal);
+            } else {
+                handle.goalSelector.addGoal(tickRate, goal);
+            }
+        } catch (Exception e) {
+            MinecraftServer.LOGGER.error("Error adding goal by name");
+            e.printStackTrace();
+        }
+    }
+
+    static PathfinderGoal getPathfinderGoal(EntityLiving handle, Class<?>[] argClasses, String className, Object[] args) throws Exception {
+        Class<?> aClass = Class.forName(className);
+        CTOR:
+        for (Constructor<?> ctor : aClass.getDeclaredConstructors()) {
+            Class<?>[] parameterTypes = ctor.getParameterTypes();
+            if ((args.length +1) != parameterTypes.length) {
+                continue;
+            }
+            if (!parameterTypes[0].isAssignableFrom(handle.getClass())) {
+                continue;
+            }
+            for (int i = 1; i < parameterTypes.length; i++) {
+                Class<?> pCls = parameterTypes[i];
+                // TODO: Map argClasses from CB counterparts to NMS such as LivingEntity.class => EntityLiving.class
+                if (!pCls.isAssignableFrom(argClasses[i-1])) {
+                    continue CTOR;
+                }
+            }
+            Object[] newArgs = new Object[args.length+1];
+            System.arraycopy(args, 0, newArgs, 1, args.length);
+            newArgs[0] = handle;
+            return (PathfinderGoal) ctor.newInstance(newArgs);
+        }
+        return null;
+    }
+
+    private static List<Set<PathfinderGoalWrapped>> getGoalSets(EntityInsentient entity) {
+        List<Set<PathfinderGoalWrapped>> check = new ArrayList();
+        check.add(entity.goalSelector.getTaskMapValues());
+        check.add(entity.goalSelector.getTasks());
+        check.add(entity.targetSelector.getTaskMapValues());
+        check.add(entity.targetSelector.getTasks());
+        return check;
+    }
+
+    private static void removeGoal(EntityInsentient entity, PathfinderGoalWrapped o) {
+        entity.goalSelector.getTaskMapValues().remove(o);
+        entity.goalSelector.getTasks().remove(o);
+        entity.targetSelector.getTaskMapValues().remove(o);
+        entity.targetSelector.getTasks().remove(o);
+    }
+
+    public static void setEntitySize(org.bukkit.entity.Entity entity, float width, float height) {
+        ((CraftEntity)entity).getHandle().setSize(width, height);
+    }
+
+    public static void setTargetRange(Mob mob, Double range) {
+        EntityInsentient entity = (EntityInsentient) ((CraftEntity) mob).getHandle();
+        entity.targetRange = range;
+    }
+
+    public static void setRangedAttackDistance(RangedEntity monster, float range) {
+        setTargetRange(monster, (double) range);
+        EntityInsentient entity = (EntityInsentient) ((CraftEntity) monster).getHandle();
+        getGoalSets(entity).forEach(set -> set.forEach(o -> {
+            PathfinderGoal goal = o.getGoal();
+            if (goal instanceof PathfinderGoalArrowAttack) {
+                ((PathfinderGoalArrowAttack) goal).setDist(range);
+            } else if (goal instanceof PathfinderGoalBowShoot) {
+                ((PathfinderGoalBowShoot) goal).setDist(range);
+            }
+        }));
+    }
+
+    public static void setRangedAttackSpeed(RangedEntity monster, Integer min, Integer max) {
+        if (min == null && max == null) {
+            return;
+        }
+        EntityInsentient entity = (EntityInsentient) ((CraftEntity) monster).getHandle();
+        getGoalSets(entity).forEach(set -> set.forEach(o -> {
+            PathfinderGoal goal = o.getGoal();
+            if (goal instanceof PathfinderGoalArrowAttack) {
+                if (min != null) {
+                    ((PathfinderGoalArrowAttack) goal).setMinTime(min);
+                }
+                if (max != null) {
+                    ((PathfinderGoalArrowAttack) goal).setMaxTime(max);
+                }
+            } else if (goal instanceof PathfinderGoalBowShoot) {
+                int speed = min != null && max != null ? Math.min(min, max) : (min != null ? min : max);
+                ((PathfinderGoalBowShoot) goal).setSpeed(speed);
+            }
+        }));
+    }
+
+    public static void respawnEntity(org.bukkit.entity.Entity entity) {
+        CraftEntity craft = (CraftEntity) entity;
+        Entity newHandle = craft.getHandle().teleportTo(((CraftWorld) entity.getWorld()).getHandle(),
+                MCUtil.toBlockPosition(entity.getLocation())
+        );
+        if (newHandle != null) {
+            craft.setHandle(newHandle);
+        }
+    }
+
+    public static void setEnderSignalDestination(EnderSignal enderSignal, Location target) {
+        if (enderSignal != null && target != null) {
+            if (target.getWorld() != enderSignal.getWorld()) {
+                throw new IllegalStateException("Worlds must be the same.");
+            }
+            EntityEnderSignal handle = ((CraftEnderSignal) enderSignal).getHandle();
+            handle.exactTarget = true;
+            handle.setSignalTarget(MCUtil.toBlockPosition(target));
+        }
+    }
+    public static void setEnderSignalSpeed(EnderSignal enderSignal, double speed) {
+        if (enderSignal != null) {
+            ((CraftEnderSignal) enderSignal).getHandle().speed = speed / 10000D;
+        }
+    }
+
+    public static void setEnderSignalLife(EnderSignal enderSignal, int lifeTime) {
+        if (enderSignal != null) {
+            ((CraftEnderSignal) enderSignal).getHandle().setLifeTime(lifeTime);
+        }
+    }
+
+    public static int getEnderSignalLife(EnderSignal enderSignal) {
+        if (enderSignal != null) {
+            return ((CraftEnderSignal) enderSignal).getHandle().getLifeTime();
+        }
+        return 0;
+    }
+
+    private static PathEntity getPathEntity(Mob entity) {
+        return getInsentientHandle(entity).getNavigation().getPathEntity();
+    }
+
+
+    private static PathEntity getPathEntity(Location loc, EntityInsentient handle) {
+        final boolean onGround = handle.onGround;
+        handle.onGround = true;
+        PathEntity path = null;
+        if (loc != null) {
+            path = handle.getNavigation().calculateDestination(loc.getBlockX(), loc.getBlockY(), loc.getBlockZ());
+        }
+
+        handle.onGround = onGround;
+        return path;
+    }
+
+
+    private static PathEntity getPathEntity(LivingEntity target, EntityInsentient handle) {
+        final boolean onGround = handle.onGround;
+        handle.onGround = true;
+        PathEntity path = null;
+        if (target != null) {
+            path = handle.getNavigation().calculateDestination(((CraftEntity) target).getHandle());
+        }
+
+        handle.onGround = onGround;
+        return path;
+    }
+
+    private static Location getFinalLocation(Mob entity, PathEntity pathEntity) {
+        if (pathEntity == null) {
+            return null;
+        }
+        final PathPoint pathPoint = pathEntity.getFinalPoint();
+        if (pathPoint == null) {
+            return null;
+        }
+        return new Location(entity.getWorld(), pathPoint.a, pathPoint.b, pathPoint.c);
+    }
+}
diff --git a/src/main/java/net/minecraft/server/EntityGoalAccessor.java b/src/main/java/net/minecraft/server/EntityGoalAccessor.java
new file mode 100644
index 0000000000000000000000000000000000000000..ab6d0d765fdefd919570a5e207a01ba5742d5bae
--- /dev/null
+++ b/src/main/java/net/minecraft/server/EntityGoalAccessor.java
@@ -0,0 +1,30 @@
+package net.minecraft.server;
+
+import net.minecraft.world.entity.ai.goal.PathfinderGoal;
+import net.minecraft.world.entity.ai.goal.PathfinderGoalArrowAttack;
+import net.minecraft.world.entity.ai.goal.PathfinderGoalBreakDoor;
+import net.minecraft.world.entity.ai.goal.PathfinderGoalMeleeAttack;
+import net.minecraft.world.entity.ai.goal.PathfinderGoalMoveThroughVillage;
+import net.minecraft.world.entity.ai.goal.PathfinderGoalOcelotAttack;
+import net.minecraft.world.entity.ai.goal.target.PathfinderGoalHurtByTarget;
+import net.minecraft.world.entity.ai.goal.target.PathfinderGoalNearestAttackableTarget;
+import net.minecraft.world.entity.monster.EntityBlaze;
+
+public final class EntityGoalAccessor {
+    private EntityGoalAccessor() {
+    }
+
+    public static boolean isHostileGoal(PathfinderGoal goal) {
+        if (goal instanceof PathfinderGoalMeleeAttack ||
+            goal instanceof PathfinderGoalOcelotAttack ||
+            goal instanceof EntityBlaze.PathfinderGoalBlazeFireball ||
+            goal instanceof PathfinderGoalArrowAttack ||
+            goal instanceof PathfinderGoalMoveThroughVillage ||
+            goal instanceof PathfinderGoalBreakDoor ||
+            goal instanceof PathfinderGoalNearestAttackableTarget ||
+            goal instanceof PathfinderGoalHurtByTarget) {
+            return true;
+        }
+        return false;
+    }
+}
diff --git a/src/main/java/net/minecraft/server/level/WorldServer.java b/src/main/java/net/minecraft/server/level/WorldServer.java
index a068c43149ddabc0f8c8e08afd5c1598a56c95cc..fb566f896d622aca84099c4040b6e36615ea80a4 100644
--- a/src/main/java/net/minecraft/server/level/WorldServer.java
+++ b/src/main/java/net/minecraft/server/level/WorldServer.java
@@ -946,7 +946,7 @@ public class WorldServer extends World implements GeneratorAccessSeed {
             entity.g(entity.locX(), entity.locY(), entity.locZ());
             entity.lastYaw = entity.yaw;
             entity.lastPitch = entity.pitch;
-            if (entity.inChunk) {
+            if (entity.inChunk && !entity.isDisabled) { // EMC
                 ++entity.ticksLived;
                 EntityTasksHandler.tickHandler(entity); // EMC
                 GameProfilerFiller gameprofilerfiller = this.getMethodProfiler();
@@ -1583,6 +1583,7 @@ public class WorldServer extends World implements GeneratorAccessSeed {
             }
             // Paper end
             entity.shouldBeRemoved = false; // Paper - shouldn't be removed after being re-added
+            com.empireminecraft.api.EntityAIApi.processEntityAddToWorld(entity); // EMC
             new com.destroystokyo.paper.event.entity.EntityAddToWorldEvent(entity.getBukkitEntity()).callEvent(); // Paper - fire while valid
         }
 
diff --git a/src/main/java/net/minecraft/world/entity/Entity.java b/src/main/java/net/minecraft/world/entity/Entity.java
index e753c32ddcf1aa4d62bccf7c939483f85aad963b..b872f9b27fe044f8c36c97d510c8ba1662932270 100644
--- a/src/main/java/net/minecraft/world/entity/Entity.java
+++ b/src/main/java/net/minecraft/world/entity/Entity.java
@@ -217,7 +217,7 @@ public abstract class Entity implements INamableTileEntity, ICommandListener, ne
     public float lastYaw;
     public float lastPitch;
     private AxisAlignedBB boundingBox;
-    protected boolean onGround;
+    public boolean onGround; // EMC - make public
     public boolean positionChanged;
     public boolean v;
     public boolean velocityChanged;
@@ -245,6 +245,9 @@ public abstract class Entity implements INamableTileEntity, ICommandListener, ne
     protected Tag<FluidType> O;
     public int noDamageTicks;
     protected boolean justCreated;
+    public boolean fireProof; // EMC
+    public boolean firePanicProof; // EMC
+    public boolean isDisabled = false; // EMC
     protected final DataWatcher datawatcher;
     protected static final DataWatcherObject<Byte> S = DataWatcher.a(Entity.class, DataWatcherRegistry.a);
     private static final DataWatcherObject<Integer> AIR_TICKS = DataWatcher.a(Entity.class, DataWatcherRegistry.b);
@@ -273,7 +276,7 @@ public abstract class Entity implements INamableTileEntity, ICommandListener, ne
     private boolean az;
     private final double[] aA;
     private long aB;
-    private EntitySize size;
+    private EntitySize size;public void setSize(float width, float height) { size = EntitySize.b(width, height); } // EMC
     private float headHeight;
     // CraftBukkit start
     public boolean persist = true;
@@ -485,6 +488,7 @@ public abstract class Entity implements INamableTileEntity, ICommandListener, ne
     }
 
     public void setPosition(double d0, double d1, double d2) {
+        if (isDisabled) { return; } // EMC
         this.setPositionRaw(d0, d1, d2);
         //this.a(this.size.a(d0, d1, d2)); // Paper - move into setPositionRaw
         if (valid) ((WorldServer) world).chunkCheck(this); // CraftBukkit
@@ -512,6 +516,7 @@ public abstract class Entity implements INamableTileEntity, ICommandListener, ne
     // CraftBukkit end
 
     public void entityBaseTick() {
+        if (isDisabled) { return; } // EMC
         this.world.getMethodProfiler().enter("entityBaseTick");
         if (this.isPassenger() && this.getVehicle().dead) {
             this.stopRiding();
@@ -688,6 +693,7 @@ public abstract class Entity implements INamableTileEntity, ICommandListener, ne
     }
 
     public void move(EnumMoveType enummovetype, Vec3D vec3d) {
+        if (isDisabled) { return; } // EMC
         if (this.noclip) {
             this.a(this.getBoundingBox().c(vec3d));
             this.recalcPosition();
@@ -1151,7 +1157,7 @@ public abstract class Entity implements INamableTileEntity, ICommandListener, ne
     }
 
     public boolean isFireProof() {
-        return this.getEntityType().c();
+        return this.getEntityType().c() || this.fireProof; // EMC
     }
 
     public boolean b(float f, float f1) {
@@ -1383,6 +1389,7 @@ public abstract class Entity implements INamableTileEntity, ICommandListener, ne
     }
 
     public void setLocation(double d0, double d1, double d2, float f, float f1) {
+        if (isDisabled) { return; } // EMC
         this.f(d0, d1, d2);
         this.yaw = f % 360.0F;
         this.pitch = MathHelper.a(f1, -90.0F, 90.0F) % 360.0F;
@@ -1414,6 +1421,7 @@ public abstract class Entity implements INamableTileEntity, ICommandListener, ne
     }
 
     public void setPositionRotation(double d0, double d1, double d2, float f, float f1) {
+        if (isDisabled) { return; } // EMC
         // Paper - cancel entity velocity if teleported
         if (!preserveMotion) {
             this.mot = Vec3D.ORIGIN;
@@ -1469,6 +1477,7 @@ public abstract class Entity implements INamableTileEntity, ICommandListener, ne
     public void pickup(EntityHuman entityhuman) {}
 
     public void collide(Entity entity) {
+        if (isDisabled) { return; } // EMC
         if (!this.isSameVehicle(entity)) {
             if (!entity.noclip && !this.noclip) {
                 if (this.world.paperConfig.onlyPlayersCollide && !(entity instanceof EntityPlayer || this instanceof EntityPlayer)) return; // Paper
@@ -1506,6 +1515,7 @@ public abstract class Entity implements INamableTileEntity, ICommandListener, ne
     }
 
     public void i(double d0, double d1, double d2) {
+        if (isDisabled) { return; } // EMC
         this.setMot(this.getMot().add(d0, d1, d2));
         this.impulse = true;
     }
@@ -1515,6 +1525,7 @@ public abstract class Entity implements INamableTileEntity, ICommandListener, ne
     }
 
     public boolean damageEntity(DamageSource damagesource, float f) {
+        if (isDisabled) { return false; } // EMC
         if (this.isInvulnerable(damagesource)) {
             return false;
         } else {
@@ -2631,7 +2642,7 @@ public abstract class Entity implements INamableTileEntity, ICommandListener, ne
     }
 
     public boolean isInvulnerable(DamageSource damagesource) {
-        return this.invulnerable && damagesource != DamageSource.OUT_OF_WORLD && !damagesource.v();
+        return this.invulnerable && damagesource != DamageSource.OUT_OF_WORLD && !damagesource.v() && !isDisabled; // EMC - add && !isDisabled
     }
 
     public boolean isInvulnerable() {
@@ -3076,6 +3087,7 @@ public abstract class Entity implements INamableTileEntity, ICommandListener, ne
         return false;
     }
 
+    public void processEnchantsForAttack(EntityLiving entityliving, Entity entity) { this.a(entityliving, entity); } // EMC - OBF HELPER
     public void a(EntityLiving entityliving, Entity entity) {
         if (entity instanceof EntityLiving) {
             EnchantmentManager.a((EntityLiving) entity, (Entity) entityliving);
diff --git a/src/main/java/net/minecraft/world/entity/EntityCreature.java b/src/main/java/net/minecraft/world/entity/EntityCreature.java
index 831414980d40f4382cf7370db28dd8fae534384b..fa0fbd8ac4f3f2e4bb2862fb32ca3a9e87677010 100644
--- a/src/main/java/net/minecraft/world/entity/EntityCreature.java
+++ b/src/main/java/net/minecraft/world/entity/EntityCreature.java
@@ -16,6 +16,7 @@ public abstract class EntityCreature extends EntityInsentient {
     public org.bukkit.craftbukkit.entity.CraftCreature getBukkitCreature() { return (org.bukkit.craftbukkit.entity.CraftCreature) super.getBukkitEntity(); } // Paper
     public BlockPosition movingTarget = null; public BlockPosition getMovingTarget() { return movingTarget; } // Paper
 
+    public boolean markedAggressive = false; // EMC
     protected EntityCreature(EntityTypes<? extends EntityCreature> entitytypes, World world) {
         super(entitytypes, world);
     }
diff --git a/src/main/java/net/minecraft/world/entity/EntityInsentient.java b/src/main/java/net/minecraft/world/entity/EntityInsentient.java
index a246edd09854dabf095da75c9d200f5cf26e7138..64c1b2f49e443a11e8a58ef071f559fedc8e05fb 100644
--- a/src/main/java/net/minecraft/world/entity/EntityInsentient.java
+++ b/src/main/java/net/minecraft/world/entity/EntityInsentient.java
@@ -122,6 +122,7 @@ public abstract class EntityInsentient extends EntityLiving {
     private NBTTagCompound by;
     private BlockPosition bz;
     private float bA;
+    public Double targetRange; // EMC
 
     public boolean aware = true; // CraftBukkit
 
diff --git a/src/main/java/net/minecraft/world/entity/EntityLiving.java b/src/main/java/net/minecraft/world/entity/EntityLiving.java
index 206f3d2e60ee190ea054cf9f81c0f50671dcf868..1d12790a61f1144c1526595f10403b6407850eef 100644
--- a/src/main/java/net/minecraft/world/entity/EntityLiving.java
+++ b/src/main/java/net/minecraft/world/entity/EntityLiving.java
@@ -307,7 +307,7 @@ public abstract class EntityLiving extends Entity {
     }
 
     public static AttributeProvider.Builder cL() {
-        return AttributeProvider.a().a(GenericAttributes.MAX_HEALTH).a(GenericAttributes.KNOCKBACK_RESISTANCE).a(GenericAttributes.MOVEMENT_SPEED).a(GenericAttributes.ARMOR).a(GenericAttributes.ARMOR_TOUGHNESS);
+        return AttributeProvider.a().a(GenericAttributes.MAX_HEALTH).a(GenericAttributes.KNOCKBACK_RESISTANCE).a(GenericAttributes.MOVEMENT_SPEED).a(GenericAttributes.ARMOR).a(GenericAttributes.ARMOR_TOUGHNESS).a(GenericAttributes.ATTACK_DAMAGE, 2.0D); // EMC - add Attack Damage
     }
 
     @Override
@@ -629,6 +629,7 @@ public abstract class EntityLiving extends Entity {
         return this.bt;
     }
 
+    public void setLastAttacker(Entity entity) { this.z(entity); } // EMC - OBF HELPER
     public void z(Entity entity) {
         if (entity instanceof EntityLiving) {
             this.bs = (EntityLiving) entity;
@@ -714,7 +715,19 @@ public abstract class EntityLiving extends Entity {
         this.setAbsorptionHearts(absorptionAmount);
         // Paper end
         if (nbttagcompound.hasKeyOfType("Attributes", 9) && this.world != null && !this.world.isClientSide) {
-            this.getAttributeMap().a(nbttagcompound.getList("Attributes", 10));
+            // EMC start
+            NBTTagList nbttaglist = nbttagcompound.getList("Attributes", 10);
+            Set<Integer> removeIndices = new HashSet<>();
+            for (int i = 0; i < nbttaglist.size(); ++i) {
+                if ("generic.targetRange".equals(nbttaglist.getCompound(i).getString("Name"))) {
+                    removeIndices.add(i);
+                }
+            }
+            for (int index : removeIndices) {
+                nbttaglist.remove(index);
+            }
+            this.getAttributeMap().a(nbttaglist);
+            // EMC end
         }
 
         if (nbttagcompound.hasKeyOfType("ActiveEffects", 9)) {
@@ -2535,7 +2548,16 @@ public abstract class EntityLiving extends Entity {
 
     public boolean attackEntity(Entity entity) {
         this.z(entity);
-        return false;
+        // EMC start - make all mobs able to attack
+        boolean flag = entity.damageEntity(DamageSource.mobAttack(this), (float) ((int) this.getAttributeInstance(GenericAttributes.ATTACK_DAMAGE).getValue()));
+
+        if (flag) {
+            this.processEnchantsForAttack(this, entity);
+            this.setLastAttacker(entity);
+        }
+
+        return flag;
+        // EMC end
     }
 
     @Override
diff --git a/src/main/java/net/minecraft/world/entity/ai/goal/PathfinderGoalArrowAttack.java b/src/main/java/net/minecraft/world/entity/ai/goal/PathfinderGoalArrowAttack.java
new file mode 100644
index 0000000000000000000000000000000000000000..09b95d5bc416688dc7d848591eca2235affcc7f0
--- /dev/null
+++ b/src/main/java/net/minecraft/world/entity/ai/goal/PathfinderGoalArrowAttack.java
@@ -0,0 +1,103 @@
+package net.minecraft.world.entity.ai.goal;
+
+import java.util.EnumSet;
+import net.minecraft.util.MathHelper;
+import net.minecraft.world.entity.Entity;
+import net.minecraft.world.entity.EntityInsentient;
+import net.minecraft.world.entity.EntityLiving;
+import net.minecraft.world.entity.monster.IRangedEntity;
+
+public class PathfinderGoalArrowAttack extends PathfinderGoal {
+
+    private final EntityInsentient a;
+    private final IRangedEntity b;
+    private EntityLiving c;
+    private int d;
+    private final double e;
+    private int f;
+    public int g;public void setMinTime(int time) { this.g = time; } // EMC - OBF HELPER - min ranged time
+    public int h;public void setMaxTime(int time) { this.h = time; } // EMC - OBF HELPER - max ranged time
+    public float i;public void setDist(float range) { this.i = range; j = range*range; } // EMC - OBF HELPER - max ranged dist
+    public float j; // EMC - max ranged dist square
+
+    public PathfinderGoalArrowAttack(IRangedEntity irangedentity, double d0, int i, float f) {
+        this(irangedentity, d0, i, i, f);
+    }
+
+    public PathfinderGoalArrowAttack(IRangedEntity irangedentity, double d0, int i, int j, float f) {
+        this.d = -1;
+        if (!(irangedentity instanceof EntityLiving)) {
+            throw new IllegalArgumentException("ArrowAttackGoal requires Mob implements RangedAttackMob");
+        } else {
+            this.b = irangedentity;
+            this.a = (EntityInsentient) irangedentity;
+            this.e = d0;
+            this.g = i;
+            this.h = j;
+            this.i = f;
+            this.j = f * f;
+            this.a(EnumSet.of(PathfinderGoal.Type.MOVE, PathfinderGoal.Type.LOOK));
+        }
+    }
+
+    @Override
+    public boolean a() {
+        EntityLiving entityliving = this.a.getGoalTarget();
+
+        if (entityliving != null && entityliving.isAlive()) {
+            this.c = entityliving;
+            return true;
+        } else {
+            return false;
+        }
+    }
+
+    @Override
+    public boolean b() {
+        return this.a() || !this.a.getNavigation().m();
+    }
+
+    @Override
+    public void d() {
+        this.c = null;
+        this.f = 0;
+        this.d = -1;
+    }
+
+    @Override
+    public void e() {
+        double d0 = this.a.h(this.c.locX(), this.c.locY(), this.c.locZ());
+        boolean flag = this.a.getEntitySenses().a(this.c);
+
+        if (flag) {
+            ++this.f;
+        } else {
+            this.f = 0;
+        }
+
+        if (d0 <= (double) this.j && this.f >= 5) {
+            this.a.getNavigation().o();
+        } else {
+            this.a.getNavigation().a((Entity) this.c, this.e);
+        }
+
+        this.a.getControllerLook().a(this.c, 30.0F, 30.0F);
+        float f;
+
+        if (--this.d == 0) {
+            if (!flag) {
+                return;
+            }
+
+            f = MathHelper.sqrt(d0) / this.i;
+            float f1 = MathHelper.a(f, 0.1F, 1.0F);
+
+            this.b.a(this.c, f1);
+            this.d = MathHelper.d(f * (float) (this.h - this.g) + (float) this.g);
+        } else if (this.d < 0) {
+            f = MathHelper.sqrt(d0) / this.i;
+            this.d = MathHelper.d(f * (float) (this.h - this.g) + (float) this.g);
+        }
+
+    }
+}
diff --git a/src/main/java/net/minecraft/world/entity/ai/goal/PathfinderGoalBowShoot.java b/src/main/java/net/minecraft/world/entity/ai/goal/PathfinderGoalBowShoot.java
new file mode 100644
index 0000000000000000000000000000000000000000..179206cd5e3bbe79835de9e4f0138acee5a9612e
--- /dev/null
+++ b/src/main/java/net/minecraft/world/entity/ai/goal/PathfinderGoalBowShoot.java
@@ -0,0 +1,135 @@
+package net.minecraft.world.entity.ai.goal;
+
+import java.util.EnumSet;
+import net.minecraft.world.entity.Entity;
+import net.minecraft.world.entity.EntityLiving;
+import net.minecraft.world.entity.monster.EntityMonster;
+import net.minecraft.world.entity.monster.IRangedEntity;
+import net.minecraft.world.entity.projectile.ProjectileHelper;
+import net.minecraft.world.item.ItemBow;
+import net.minecraft.world.item.Items;
+
+public class PathfinderGoalBowShoot<T extends EntityMonster & IRangedEntity> extends PathfinderGoal {
+
+    private final T a;
+    private final double b;
+    private int c;public void setSpeed(int speed) { this.c = speed; } // EMC - OBF HELPER
+    private float d;public float getDistSq() { return d; } public void setDist(float range) { this.d = range*range; } // EMC - OBF HELPER - max ranged dist // EMC - OBF HELPER - max ranged dist square
+    private int e = -1;
+    private int f;
+    private boolean g;
+    private boolean h;
+    private int i = -1;
+
+    public PathfinderGoalBowShoot(T t0, double d0, int i, float f) {
+        this.a = t0;
+        this.b = d0;
+        this.c = i;
+        this.d = f * f;
+        this.a(EnumSet.of(PathfinderGoal.Type.MOVE, PathfinderGoal.Type.LOOK));
+    }
+
+    public void a(int i) {
+        this.c = i;
+    }
+
+    @Override
+    public boolean a() {
+        return this.a.getGoalTarget() == null ? false : this.g();
+    }
+
+    protected boolean g() {
+        return this.a.a(Items.BOW);
+    }
+
+    @Override
+    public boolean b() {
+        return (this.a() || !this.a.getNavigation().m()) && this.g();
+    }
+
+    @Override
+    public void c() {
+        super.c();
+        this.a.setAggressive(true);
+    }
+
+    @Override
+    public void d() {
+        super.d();
+        this.a.setAggressive(false);
+        this.f = 0;
+        this.e = -1;
+        this.a.clearActiveItem();
+    }
+
+    @Override
+    public void e() {
+        EntityLiving entityliving = this.a.getGoalTarget();
+
+        if (entityliving != null) {
+            double d0 = this.a.h(entityliving.locX(), entityliving.locY(), entityliving.locZ());
+            boolean flag = this.a.getEntitySenses().a(entityliving);
+            boolean flag1 = this.f > 0;
+
+            if (flag != flag1) {
+                this.f = 0;
+            }
+
+            if (flag) {
+                ++this.f;
+            } else {
+                --this.f;
+            }
+
+            if (d0 <= (double) this.d && this.f >= 20) {
+                this.a.getNavigation().o();
+                ++this.i;
+            } else {
+                this.a.getNavigation().a((Entity) entityliving, this.b);
+                this.i = -1;
+            }
+
+            if (this.i >= 20) {
+                if ((double) this.a.getRandom().nextFloat() < 0.3D) {
+                    this.g = !this.g;
+                }
+
+                if ((double) this.a.getRandom().nextFloat() < 0.3D) {
+                    this.h = !this.h;
+                }
+
+                this.i = 0;
+            }
+
+            if (this.i > -1) {
+                if (d0 > (double) (this.d * 0.75F)) {
+                    this.h = false;
+                } else if (d0 < (double) (this.d * 0.25F)) {
+                    this.h = true;
+                }
+
+                this.a.getControllerMove().a(this.h ? -0.5F : 0.5F, this.g ? 0.5F : -0.5F);
+                this.a.a((Entity) entityliving, 30.0F, 30.0F);
+            } else {
+                this.a.getControllerLook().a(entityliving, 30.0F, 30.0F);
+            }
+
+            if (this.a.isHandRaised()) {
+                if (!flag && this.f < -60) {
+                    this.a.clearActiveItem();
+                } else if (flag) {
+                    int i = this.a.ea();
+
+                    if (i >= 20) {
+                        this.a.clearActiveItem();
+                        ((IRangedEntity) this.a).a(entityliving, ItemBow.a(i));
+                        this.e = this.c;
+                    }
+                }
+            } else if (--this.e <= 0 && this.f >= -60) {
+                this.a.c(ProjectileHelper.a((EntityLiving) this.a, Items.BOW));
+            }
+
+        }
+    }
+}
diff --git a/src/main/java/net/minecraft/world/entity/ai/goal/PathfinderGoalFleeSun.java b/src/main/java/net/minecraft/world/entity/ai/goal/PathfinderGoalFleeSun.java
new file mode 100644
index 0000000000000000000000000000000000000000..83a8f77e85c72abb51e40c662d56bbeea17e5e5f
--- /dev/null
+++ b/src/main/java/net/minecraft/world/entity/ai/goal/PathfinderGoalFleeSun.java
@@ -0,0 +1,72 @@
+package net.minecraft.world.entity.ai.goal;
+
+import java.util.EnumSet;
+import java.util.Random;
+import javax.annotation.Nullable;
+import net.minecraft.core.BaseBlockPosition;
+import net.minecraft.core.BlockPosition;
+import net.minecraft.world.entity.EntityCreature;
+import net.minecraft.world.entity.EnumItemSlot;
+import net.minecraft.world.level.World;
+import net.minecraft.world.phys.Vec3D;
+
+public class PathfinderGoalFleeSun extends PathfinderGoal {
+
+    protected final EntityCreature a;EntityCreature getEntity() { return a; } // EMC - OBF HELPER
+    private double b;
+    private double c;
+    private double d;
+    private final double e;
+    private final World f;
+
+    public PathfinderGoalFleeSun(EntityCreature entitycreature, double d0) {
+        this.a = entitycreature;
+        this.e = d0;
+        this.f = entitycreature.world;
+        this.a(EnumSet.of(PathfinderGoal.Type.MOVE));
+    }
+
+    @Override
+    public boolean a() {
+        return this.a.getGoalTarget() != null ? false : (!this.f.isDay() ? false : ((this.getEntity().firePanicProof || !this.a.isBurning()) ? false : (!this.f.e(this.a.getChunkCoordinates()) ? false : (!this.a.getEquipment(EnumItemSlot.HEAD).isEmpty() ? false : this.g())))); // EMC
+    }
+
+    protected boolean g() {
+        Vec3D vec3d = this.h();
+
+        if (vec3d == null) {
+            return false;
+        } else {
+            this.b = vec3d.x;
+            this.c = vec3d.y;
+            this.d = vec3d.z;
+            return true;
+        }
+    }
+
+    @Override
+    public boolean b() {
+        return !this.a.getNavigation().m();
+    }
+
+    @Override
+    public void c() {
+        this.a.getNavigation().a(this.b, this.c, this.d, this.e);
+    }
+
+    @Nullable
+    protected Vec3D h() {
+        Random random = this.a.getRandom();
+        BlockPosition blockposition = this.a.getChunkCoordinates();
+
+        for (int i = 0; i < 10; ++i) {
+            BlockPosition blockposition1 = blockposition.b(random.nextInt(20) - 10, random.nextInt(6) - 3, random.nextInt(20) - 10);
+
+            if (!this.f.e(blockposition1) && this.a.f(blockposition1) < 0.0F) {
+                return Vec3D.c((BaseBlockPosition) blockposition1);
+            }
+        }
+
+        return null;
+    }
+}
diff --git a/src/main/java/net/minecraft/world/entity/ai/goal/PathfinderGoalMeleeAttack.java b/src/main/java/net/minecraft/world/entity/ai/goal/PathfinderGoalMeleeAttack.java
new file mode 100644
index 0000000000000000000000000000000000000000..52dcf2f2d3e75b64013083298db481c2710570c4
--- /dev/null
+++ b/src/main/java/net/minecraft/world/entity/ai/goal/PathfinderGoalMeleeAttack.java
@@ -0,0 +1,139 @@
+package net.minecraft.world.entity.ai.goal;
+
+import java.util.EnumSet;
+import net.minecraft.world.EnumHand;
+import net.minecraft.world.entity.Entity;
+import net.minecraft.world.entity.EntityCreature;
+import net.minecraft.world.entity.EntityLiving;
+import net.minecraft.world.entity.IEntitySelector;
+import net.minecraft.world.entity.player.EntityHuman;
+import net.minecraft.world.level.pathfinder.PathEntity;
+
+public class PathfinderGoalMeleeAttack extends PathfinderGoal {
+
+    protected final EntityCreature a;
+    private final double b;
+    private final boolean c;
+    private PathEntity d;
+    private double e;
+    private double f;
+    private double g;
+    private int h;
+    private int i;
+    private final int j = 20;
+    private long k;
+
+    public PathfinderGoalMeleeAttack(EntityCreature entitycreature, double d0, boolean flag) {
+        this.a = entitycreature;
+        this.b = d0;
+        this.c = flag;
+        this.a(EnumSet.of(PathfinderGoal.Type.MOVE, PathfinderGoal.Type.LOOK));
+    }
+
+    @Override
+    public boolean a() {
+        long i = this.a.world.getTime();
+
+        if (i - this.k < 20L) {
+            return false;
+        } else {
+            this.k = i;
+            EntityLiving entityliving = this.a.getGoalTarget();
+
+            if (entityliving == null) {
+                return false;
+            } else if (!entityliving.isAlive()) {
+                return false;
+            } else {
+                this.d = this.a.getNavigation().a((Entity) entityliving, 0);
+                return this.d != null ? true : this.a(entityliving) >= this.a.h(entityliving.locX(), entityliving.locY(), entityliving.locZ());
+            }
+        }
+    }
+
+    @Override
+    public boolean b() {
+        EntityLiving entityliving = this.a.getGoalTarget();
+
+        return entityliving == null ? false : (!entityliving.isAlive() ? false : (!this.c ? !this.a.getNavigation().m() : (!this.a.a(entityliving.getChunkCoordinates()) ? false : !(entityliving instanceof EntityHuman) || !entityliving.isSpectator() && !((EntityHuman) entityliving).isCreative())));
+    }
+
+    @Override
+    public void c() {
+        this.a.getNavigation().a(this.d, this.b);
+        this.a.setAggressive(true);
+        this.h = 0;
+        this.i = 0;
+    }
+
+    @Override
+    public void d() {
+        EntityLiving entityliving = this.a.getGoalTarget();
+
+        if (!IEntitySelector.e.test(entityliving)) {
+            this.a.setGoalTarget((EntityLiving) null);
+        }
+
+        this.a.setAggressive(false);
+        this.a.getNavigation().o();
+    }
+
+    @Override
+    public void e() {
+        EntityLiving entityliving = this.a.getGoalTarget();
+        if (entityliving == null) { return; } // EMC - Do not process for null targets
+        this.a.getControllerLook().a(entityliving, 30.0F, 30.0F);
+        double d0 = this.a.h(entityliving.locX(), entityliving.locY(), entityliving.locZ());
+
+        this.h = Math.max(this.h - 1, 0);
+        if ((this.c || this.a.getEntitySenses().a(entityliving)) && this.h <= 0 && (this.e == 0.0D && this.f == 0.0D && this.g == 0.0D || entityliving.h(this.e, this.f, this.g) >= 1.0D || this.a.getRandom().nextFloat() < 0.05F)) {
+            this.e = entityliving.locX();
+            this.f = entityliving.locY();
+            this.g = entityliving.locZ();
+            this.h = 4 + this.a.getRandom().nextInt(7);
+            if (d0 > 1024.0D) {
+                this.h += 10;
+            } else if (d0 > 256.0D) {
+                this.h += 5;
+            }
+
+            if (!this.a.getNavigation().a((Entity) entityliving, this.b)) {
+                this.h += 15;
+            }
+        }
+
+        this.i = Math.max(this.i - 1, 0);
+        this.a(entityliving, d0);
+    }
+
+    protected void a(EntityLiving entityliving, double d0) {
+        double d1 = this.a(entityliving);
+
+        if (d0 <= d1 && this.i <= 0) {
+            this.g();
+            this.a.swingHand(EnumHand.MAIN_HAND);
+            this.a.attackEntity(entityliving);
+        }
+
+    }
+
+    protected void g() {
+        this.i = 20;
+    }
+
+    protected boolean h() {
+        return this.i <= 0;
+    }
+
+    protected int j() {
+        return this.i;
+    }
+
+    protected int k() {
+        return 20;
+    }
+
+    protected double a(EntityLiving entityliving) {
+        return (double) (this.a.getWidth() * 2.0F * this.a.getWidth() * 2.0F + entityliving.getWidth());
+    }
+}
diff --git a/src/main/java/net/minecraft/world/entity/ai/goal/PathfinderGoalPanic.java b/src/main/java/net/minecraft/world/entity/ai/goal/PathfinderGoalPanic.java
index 8bbd69aaebd599ab259720fd421848bdf1236da6..8ed1cab18b560eb1afaa2a0866b72557357a386e 100644
--- a/src/main/java/net/minecraft/world/entity/ai/goal/PathfinderGoalPanic.java
+++ b/src/main/java/net/minecraft/world/entity/ai/goal/PathfinderGoalPanic.java
@@ -17,7 +17,7 @@ import net.minecraft.world.entity.EntityLiving;
 
 public class PathfinderGoalPanic extends PathfinderGoal {
 
-    protected final EntityCreature a;
+    protected final EntityCreature a;public EntityCreature getCreature() { return a; } // EMC - OBF HELPER
     protected final double b;
     protected double c;
     protected double d;
@@ -32,6 +32,7 @@ public class PathfinderGoalPanic extends PathfinderGoal {
 
     @Override
     public boolean a() {
+        if (this.getCreature().firePanicProof) { return false; } // EMC
         if (this.a.getLastDamager() == null && !this.a.isBurning()) {
             return false;
         } else {
diff --git a/src/main/java/net/minecraft/world/entity/ai/goal/PathfinderGoalSelector.java b/src/main/java/net/minecraft/world/entity/ai/goal/PathfinderGoalSelector.java
index 637928664f8c7b1c694a234e507c20724294e450..0598a052e85aedc1253aa018218abd2aad40052b 100644
--- a/src/main/java/net/minecraft/world/entity/ai/goal/PathfinderGoalSelector.java
+++ b/src/main/java/net/minecraft/world/entity/ai/goal/PathfinderGoalSelector.java
@@ -1,6 +1,7 @@
 package net.minecraft.world.entity.ai.goal;
 
 import com.destroystokyo.paper.util.set.OptimizedSmallEnumSet; // Paper - remove streams from pathfindergoalselector
+import com.empireminecraft.api.API;
 import com.google.common.collect.Sets;
 import java.util.EnumMap;
 import java.util.EnumSet;
@@ -27,7 +28,7 @@ public class PathfinderGoalSelector {
             return false;
         }
     };
-    private final Map<PathfinderGoal.Type, PathfinderGoalWrapped> c = new EnumMap(PathfinderGoal.Type.class);
+    private final Map<PathfinderGoal.Type, PathfinderGoalWrapped> c = new EnumMap(PathfinderGoal.Type.class);public Set<PathfinderGoalWrapped> getTaskMapValues() { return new java.util.HashSet<>(c.values()); } // EMC - OBF HELPER
     private final Set<PathfinderGoalWrapped> d = Sets.newLinkedHashSet(); public final Set<PathfinderGoalWrapped> getTasks() { return d; }// Paper - OBFHELPER // Paper - private -> public
     private final Supplier<GameProfilerFiller> e;
     private final EnumSet<PathfinderGoal.Type> f = EnumSet.noneOf(PathfinderGoal.Type.class); // Paper unused, but dummy to prevent plugins from crashing as hard. Theyll need to support paper in a special case if this is super important, but really doesn't seem like it would be.
diff --git a/src/main/java/net/minecraft/world/entity/ai/goal/target/PathfinderGoalTarget.java b/src/main/java/net/minecraft/world/entity/ai/goal/target/PathfinderGoalTarget.java
index 657b6b7ba29ed255013a4881479073c4e0e43575..7565f1e6daa36a7dbca18d68a2823caf3a81d6e6 100644
--- a/src/main/java/net/minecraft/world/entity/ai/goal/target/PathfinderGoalTarget.java
+++ b/src/main/java/net/minecraft/world/entity/ai/goal/target/PathfinderGoalTarget.java
@@ -81,6 +81,7 @@ public abstract class PathfinderGoalTarget extends PathfinderGoal {
     }
 
     protected double k() {
+        if (e.targetRange != null) { return e.targetRange; } // EMC
         return this.e.b(GenericAttributes.FOLLOW_RANGE);
     }
 
diff --git a/src/main/java/net/minecraft/world/entity/animal/EntityAnimal.java b/src/main/java/net/minecraft/world/entity/animal/EntityAnimal.java
index 28dd42921961c6a47f2d85a5f93b8298f2c228d3..fad04d2c023b00f23a15373da705679c2965993c 100644
--- a/src/main/java/net/minecraft/world/entity/animal/EntityAnimal.java
+++ b/src/main/java/net/minecraft/world/entity/animal/EntityAnimal.java
@@ -35,7 +35,7 @@ import org.bukkit.event.entity.EntityEnterLoveModeEvent;
 
 public abstract class EntityAnimal extends EntityAgeable {
 
-    public int loveTicks;
+    public int loveTicks;public void setLove(int love) { this.loveTicks = love;} public int getLove() { return this.loveTicks; } // EMC - Getter & Setter
     public UUID breedCause;
     public ItemStack breedItem; // CraftBukkit - Add breedItem variable
 
diff --git a/src/main/java/net/minecraft/world/entity/animal/EntityWolf.java b/src/main/java/net/minecraft/world/entity/animal/EntityWolf.java
index b44b1544f401c1a5127bed3239bfd60420d17329..439724de4e2e43fabba685b28da57ee3dabfd223 100644
--- a/src/main/java/net/minecraft/world/entity/animal/EntityWolf.java
+++ b/src/main/java/net/minecraft/world/entity/animal/EntityWolf.java
@@ -404,6 +404,13 @@ public class EntityWolf extends EntityTameableAnimal implements IEntityAngerable
         this.datawatcher.set(EntityWolf.bt, i);
     }
 
+    // EMC start
+    public boolean alwaysAngry = false;
+    @Override
+    public boolean isAngry() {
+        return alwaysAngry || IEntityAngerable.super.isAngry();
+    }
+    // EMC end
     @Override
     public void anger() {
         this.setAnger(EntityWolf.bA.a(this.random));
diff --git a/src/main/java/net/minecraft/world/entity/item/EntityItem.java b/src/main/java/net/minecraft/world/entity/item/EntityItem.java
index 575833807ff647f30d7c2b7abcd01701c7dec85b..d0658e84fa1f8bc00de562b749ca1be370b735a3 100644
--- a/src/main/java/net/minecraft/world/entity/item/EntityItem.java
+++ b/src/main/java/net/minecraft/world/entity/item/EntityItem.java
@@ -43,6 +43,7 @@ public class EntityItem extends Entity {
 
     private static final DataWatcherObject<ItemStack> ITEM = DataWatcher.a(EntityItem.class, DataWatcherRegistry.g);
     public int age;
+    public boolean canDespawn = true; // EMC
     public int pickupDelay;
     private int f;
     private UUID thrower;
@@ -162,7 +163,7 @@ public class EntityItem extends Entity {
                 }
             }
 
-            if (!this.world.isClientSide && this.age >= this.getDespawnRate()) { // Spigot // Paper
+            if (canDespawn && !this.world.isClientSide && this.age >= this.getDespawnRate()) { // Spigot // Paper // EMC
                 // CraftBukkit start - fire ItemDespawnEvent
                 if (org.bukkit.craftbukkit.event.CraftEventFactory.callItemDespawnEvent(this).isCancelled()) {
                     this.age = 0;
diff --git a/src/main/java/net/minecraft/world/entity/monster/EntityBlaze.java b/src/main/java/net/minecraft/world/entity/monster/EntityBlaze.java
new file mode 100644
index 0000000000000000000000000000000000000000..40172ad88889e9e24fe04cda717001e8a62237ed
--- /dev/null
+++ b/src/main/java/net/minecraft/world/entity/monster/EntityBlaze.java
@@ -0,0 +1,281 @@
+package net.minecraft.world.entity.monster;
+
+import java.util.EnumSet;
+import net.minecraft.core.particles.Particles;
+import net.minecraft.network.syncher.DataWatcher;
+import net.minecraft.network.syncher.DataWatcherObject;
+import net.minecraft.network.syncher.DataWatcherRegistry;
+import net.minecraft.sounds.SoundEffect;
+import net.minecraft.sounds.SoundEffects;
+import net.minecraft.util.MathHelper;
+import net.minecraft.world.damagesource.DamageSource;
+import net.minecraft.world.entity.Entity;
+import net.minecraft.world.entity.EntityLiving;
+import net.minecraft.world.entity.EntityTypes;
+import net.minecraft.world.entity.ai.attributes.AttributeProvider;
+import net.minecraft.world.entity.ai.attributes.GenericAttributes;
+import net.minecraft.world.entity.ai.goal.PathfinderGoal;
+import net.minecraft.world.entity.ai.goal.PathfinderGoalLookAtPlayer;
+import net.minecraft.world.entity.ai.goal.PathfinderGoalMoveTowardsRestriction;
+import net.minecraft.world.entity.ai.goal.PathfinderGoalRandomLookaround;
+import net.minecraft.world.entity.ai.goal.PathfinderGoalRandomStrollLand;
+import net.minecraft.world.entity.ai.goal.target.PathfinderGoalHurtByTarget;
+import net.minecraft.world.entity.ai.goal.target.PathfinderGoalNearestAttackableTarget;
+import net.minecraft.world.entity.player.EntityHuman;
+import net.minecraft.world.entity.projectile.EntitySmallFireball;
+import net.minecraft.world.level.World;
+import net.minecraft.world.level.pathfinder.PathType;
+import net.minecraft.world.phys.Vec3D;
+
+public class EntityBlaze extends EntityMonster {
+
+    private float b = 0.5F;
+    private int c;
+    private static final DataWatcherObject<Byte> d = DataWatcher.a(EntityBlaze.class, DataWatcherRegistry.a);
+
+    // EMC start
+    int numFireballs = 4;
+    int timeBetweenFireballs = 6;
+    public void setFireballs(int num) {
+        this.numFireballs = num;
+    }
+    public int getNumFireballs() {
+        return this.numFireballs;
+    }
+
+    public int getTimeBetweenFireballs() {
+        return timeBetweenFireballs;
+    }
+
+    public void setTimeBetweenFireballs(int timeBetweenFireballs) {
+        this.timeBetweenFireballs = timeBetweenFireballs;
+    }
+    // EMC end
+
+    public EntityBlaze(EntityTypes<? extends EntityBlaze> entitytypes, World world) {
+        super(entitytypes, world);
+        this.a(PathType.WATER, -1.0F);
+        this.a(PathType.LAVA, 8.0F);
+        this.a(PathType.DANGER_FIRE, 0.0F);
+        this.a(PathType.DAMAGE_FIRE, 0.0F);
+        this.f = 10;
+    }
+
+    @Override
+    protected void initPathfinder() {
+        this.goalSelector.a(4, new EntityBlaze.PathfinderGoalBlazeFireball(this));
+        this.goalSelector.a(5, new PathfinderGoalMoveTowardsRestriction(this, 1.0D));
+        this.goalSelector.a(7, new PathfinderGoalRandomStrollLand(this, 1.0D, 0.0F));
+        this.goalSelector.a(8, new PathfinderGoalLookAtPlayer(this, EntityHuman.class, 8.0F));
+        this.goalSelector.a(8, new PathfinderGoalRandomLookaround(this));
+        this.targetSelector.a(1, new PathfinderGoalHurtByTarget(this, new Class[0])); // EMC - Decompile Fix
+        this.targetSelector.a(2, new PathfinderGoalNearestAttackableTarget<>(this, EntityHuman.class, true));
+    }
+
+    public static AttributeProvider.Builder m() {
+        return EntityMonster.eR().a(GenericAttributes.ATTACK_DAMAGE, 6.0D).a(GenericAttributes.MOVEMENT_SPEED, 0.23000000417232513D).a(GenericAttributes.FOLLOW_RANGE, 48.0D);
+    }
+
+    @Override
+    protected void initDatawatcher() {
+        super.initDatawatcher();
+        this.datawatcher.register(EntityBlaze.d, (byte) 0);
+    }
+
+    @Override
+    protected SoundEffect getSoundAmbient() {
+        return SoundEffects.ENTITY_BLAZE_AMBIENT;
+    }
+
+    @Override
+    protected SoundEffect getSoundHurt(DamageSource damagesource) {
+        return SoundEffects.ENTITY_BLAZE_HURT;
+    }
+
+    @Override
+    protected SoundEffect getSoundDeath() {
+        return SoundEffects.ENTITY_BLAZE_DEATH;
+    }
+
+    @Override
+    public float aR() {
+        return 1.0F;
+    }
+
+    @Override
+    public void movementTick() {
+        if (!this.onGround && this.getMot().y < 0.0D) {
+            this.setMot(this.getMot().d(1.0D, 0.6D, 1.0D));
+        }
+
+        if (this.world.isClientSide) {
+            if (this.random.nextInt(24) == 0 && !this.isSilent()) {
+                this.world.a(this.locX() + 0.5D, this.locY() + 0.5D, this.locZ() + 0.5D, SoundEffects.ENTITY_BLAZE_BURN, this.getSoundCategory(), 1.0F + this.random.nextFloat(), this.random.nextFloat() * 0.7F + 0.3F, false);
+            }
+
+            for (int i = 0; i < 2; ++i) {
+                this.world.addParticle(Particles.LARGE_SMOKE, this.d(0.5D), this.cF(), this.g(0.5D), 0.0D, 0.0D, 0.0D);
+            }
+        }
+
+        super.movementTick();
+    }
+
+    @Override
+    public boolean dO() {
+        return true;
+    }
+
+    @Override
+    protected void mobTick() {
+        --this.c;
+        if (this.c <= 0) {
+            this.c = 100;
+            this.b = 0.5F + (float) this.random.nextGaussian() * 3.0F;
+        }
+
+        EntityLiving entityliving = this.getGoalTarget();
+
+        if (entityliving != null && entityliving.getHeadY() > this.getHeadY() + (double) this.b && this.c(entityliving)) {
+            Vec3D vec3d = this.getMot();
+
+            this.setMot(this.getMot().add(0.0D, (0.30000001192092896D - vec3d.y) * 0.30000001192092896D, 0.0D));
+            this.impulse = true;
+        }
+
+        super.mobTick();
+    }
+
+    @Override
+    public boolean b(float f, float f1) {
+        return false;
+    }
+
+    @Override
+    public boolean isBurning() {
+        return this.eK();
+    }
+
+    private boolean eK() {
+        return ((Byte) this.datawatcher.get(EntityBlaze.d) & 1) != 0;
+    }
+
+    private void t(boolean flag) {
+        byte b0 = (Byte) this.datawatcher.get(EntityBlaze.d);
+
+        if (flag) {
+            b0 = (byte) (b0 | 1);
+        } else {
+            b0 &= -2;
+        }
+
+        this.datawatcher.set(EntityBlaze.d, b0);
+    }
+
+    public static class PathfinderGoalBlazeFireball extends PathfinderGoal { // EMC - make public
+
+        private final EntityBlaze a;
+        private int b;
+        private int c;
+        private int d;
+
+        public PathfinderGoalBlazeFireball(EntityBlaze entityblaze) {
+            this.a = entityblaze;
+            this.a(EnumSet.of(PathfinderGoal.Type.MOVE, PathfinderGoal.Type.LOOK));
+        }
+
+        @Override
+        public boolean a() {
+            EntityLiving entityliving = this.a.getGoalTarget();
+
+            return entityliving != null && entityliving.isAlive() && this.a.c(entityliving);
+        }
+
+        @Override
+        public void c() {
+            this.b = 0;
+        }
+
+        @Override
+        public void d() {
+            this.a.t(false);
+            this.d = 0;
+        }
+
+        @Override
+        public void e() {
+            --this.c;
+            EntityLiving entityliving = this.a.getGoalTarget();
+
+            if (entityliving != null) {
+                boolean flag = this.a.getEntitySenses().a(entityliving);
+
+                if (flag) {
+                    this.d = 0;
+                } else {
+                    ++this.d;
+                }
+
+                double d0 = this.a.h((Entity) entityliving);
+
+                if (d0 < 4.0D) {
+                    if (!flag) {
+                        return;
+                    }
+
+                    if (this.c <= 0) {
+                        this.c = 20;
+                        this.a.attackEntity(entityliving);
+                    }
+
+                    this.a.getControllerMove().a(entityliving.locX(), entityliving.locY(), entityliving.locZ(), 1.0D);
+                } else if (d0 < this.g() * this.g() && flag) {
+                    double d1 = entityliving.locX() - this.a.locX();
+                    double d2 = entityliving.e(0.5D) - this.a.e(0.5D);
+                    double d3 = entityliving.locZ() - this.a.locZ();
+
+                    if (this.c <= 0) {
+                        ++this.b;
+                        if (this.b == 1) {
+                            this.c = 60;
+                            this.a.t(true);
+                        } else if (this.b <= this.a.numFireballs) { // EMC
+                            this.c = this.a.timeBetweenFireballs; // EMC
+                        } else {
+                            this.c = 100;
+                            this.b = 0;
+                            this.a.t(false);
+                        }
+
+                        if (this.b > 1) {
+                            float f = MathHelper.c(MathHelper.sqrt(d0)) * 0.5F;
+
+                            if (!this.a.isSilent()) {
+                                this.a.world.a((EntityHuman) null, 1018, this.a.getChunkCoordinates(), 0);
+                            }
+
+                            for (int i = 0; i < 1; ++i) {
+                                EntitySmallFireball entitysmallfireball = new EntitySmallFireball(this.a.world, this.a, d1 + this.a.getRandom().nextGaussian() * (double) f, d2, d3 + this.a.getRandom().nextGaussian() * (double) f);
+
+                                entitysmallfireball.setPosition(entitysmallfireball.locX(), this.a.e(0.5D) + 0.5D, entitysmallfireball.locZ());
+                                if (new com.empireminecraft.customevents.BlazeLaunchFireballEvent((org.bukkit.entity.Blaze) this.a.getBukkitEntity(), (org.bukkit.entity.SmallFireball) entitysmallfireball.getBukkitEntity()).callEvent()) { // EMC
+                                this.a.world.addEntity(entitysmallfireball);
+                                } else { entitysmallfireball.die(); }// EMC
+                            }
+                        }
+                    }
+
+                    this.a.getControllerLook().a(entityliving, 10.0F, 10.0F);
+                } else if (this.d < 5) {
+                    this.a.getControllerMove().a(entityliving.locX(), entityliving.locY(), entityliving.locZ(), 1.0D);
+                }
+
+                super.e();
+            }
+        }
+
+        private double g() {
+            return this.a.b(GenericAttributes.FOLLOW_RANGE);
+        }
+    }
+}
diff --git a/src/main/java/net/minecraft/world/entity/monster/EntityGhast.java b/src/main/java/net/minecraft/world/entity/monster/EntityGhast.java
index a3e3f6e07674c54c2d2a02661ce4342b43aafe44..b29aafc3b305119ab0b3b2b29db2bc93db4a1fde 100644
--- a/src/main/java/net/minecraft/world/entity/monster/EntityGhast.java
+++ b/src/main/java/net/minecraft/world/entity/monster/EntityGhast.java
@@ -37,6 +37,7 @@ public class EntityGhast extends EntityFlying implements IMonster {
 
     private static final DataWatcherObject<Boolean> b = DataWatcher.a(EntityGhast.class, DataWatcherRegistry.i);
     private int c = 1;
+    public int fireballCooldown = 40; // EMC
 
     public EntityGhast(EntityTypes<? extends EntityGhast> entitytypes, World world) {
         super(entitytypes, world);
@@ -197,7 +198,7 @@ public class EntityGhast extends EntityFlying implements IMonster {
                     entitylargefireball.bukkitYield = entitylargefireball.yield = this.ghast.getPower();
                     entitylargefireball.setPosition(this.ghast.locX() + vec3d.x * 4.0D, this.ghast.e(0.5D) + 0.5D, entitylargefireball.locZ() + vec3d.z * 4.0D);
                     world.addEntity(entitylargefireball);
-                    this.a = -40;
+                    this.a = -ghast.fireballCooldown; // EMC
                 }
             } else if (this.a > 0) {
                 --this.a;
diff --git a/src/main/java/net/minecraft/world/entity/monster/EntitySpider.java b/src/main/java/net/minecraft/world/entity/monster/EntitySpider.java
index c7b443623f3dd90741e52216199d8ed90bcea6b3..a7a4437f3c47fd4d966ec478d01cc16a6d0a9de9 100644
--- a/src/main/java/net/minecraft/world/entity/monster/EntitySpider.java
+++ b/src/main/java/net/minecraft/world/entity/monster/EntitySpider.java
@@ -187,6 +187,8 @@ public class EntitySpider extends EntityMonster {
         return 0.65F;
     }
 
+    public boolean attackDuringDay = false; // EMC
+
     static class PathfinderGoalSpiderNearestAttackableTarget<T extends EntityLiving> extends PathfinderGoalNearestAttackableTarget<T> {
 
         public PathfinderGoalSpiderNearestAttackableTarget(EntitySpider entityspider, Class<T> oclass) {
@@ -196,6 +198,7 @@ public class EntitySpider extends EntityMonster {
         @Override
         public boolean a() {
             float f = this.e.aR();
+            if (((EntitySpider)this.e).attackDuringDay) f = 0.0F; // EMC
 
             return f >= 0.5F ? false : super.a();
         }
@@ -215,6 +218,7 @@ public class EntitySpider extends EntityMonster {
         @Override
         public boolean b() {
             float f = this.a.aR();
+            if (((EntitySpider)this.a).attackDuringDay) f = 0.0F; // EMC
 
             if (f >= 0.5F && this.a.getRandom().nextInt(100) == 0) {
                 this.a.setGoalTarget((EntityLiving) null);
diff --git a/src/main/java/net/minecraft/world/entity/projectile/EntityEnderSignal.java b/src/main/java/net/minecraft/world/entity/projectile/EntityEnderSignal.java
index 6df88dc28c58928c1abff24ebda580d043806b5c..b8f79d516ce6b8c338ae10c2f6a5b885953fef1a 100644
--- a/src/main/java/net/minecraft/world/entity/projectile/EntityEnderSignal.java
+++ b/src/main/java/net/minecraft/world/entity/projectile/EntityEnderSignal.java
@@ -28,6 +28,18 @@ public class EntityEnderSignal extends Entity {
     public int despawnTimer;
     public boolean shouldDropItem;
 
+    // EMC start
+    private int lifeTime = 80;
+    public void setLifeTime(int lifeTime) {
+        this.lifeTime = lifeTime;
+    }
+    public int getLifeTime() {
+        return this.lifeTime;
+    }
+    public double speed = 0.0025D;
+    public boolean exactTarget = false;
+    // EMC end
+
     public EntityEnderSignal(EntityTypes<? extends EntityEnderSignal> entitytypes, World world) {
         super(entitytypes, world);
     }
@@ -62,6 +74,7 @@ public class EntityEnderSignal extends Entity {
         this.getDataWatcher().register(EntityEnderSignal.b, ItemStack.b);
     }
 
+    public void setSignalTarget(BlockPosition pos) { a(pos); } // EMC - OBF HELPER
     public void a(BlockPosition blockposition) {
         double d0 = (double) blockposition.getX();
         int i = blockposition.getY();
@@ -70,6 +83,7 @@ public class EntityEnderSignal extends Entity {
         double d3 = d1 - this.locZ();
         float f = MathHelper.sqrt(d2 * d2 + d3 * d3);
 
+        if (exactTarget) f = 0; // EMC
         if (f > 12.0F) {
             this.targetX = this.locX() + d2 / (double) f * 12.0D;
             this.targetZ = this.locZ() + d3 / (double) f * 12.0D;
@@ -98,9 +112,10 @@ public class EntityEnderSignal extends Entity {
         if (!this.world.isClientSide) {
             double d3 = this.targetX - d0;
             double d4 = this.targetZ - d2;
-            float f1 = (float) Math.sqrt(d3 * d3 + d4 * d4);
+            double distY = this.targetY - d1; // EMC
+            float f1 = (float) Math.sqrt(d3 * d3 + d4 * d4 + (exactTarget ? distY * distY : 0)); // EMC
             float f2 = (float) MathHelper.d(d4, d3);
-            double d5 = MathHelper.d(0.0025D, (double) f, (double) f1);
+            double d5 = MathHelper.d(speed, (double) f, (double) f1); // EMC
             double d6 = vec3d.y;
 
             if (f1 < 1.0F) {
@@ -128,6 +143,7 @@ public class EntityEnderSignal extends Entity {
             this.setPosition(d0, d1, d2);
             ++this.despawnTimer;
             if (this.despawnTimer > 80 && !this.world.isClientSide) {
+                if (!(new com.empireminecraft.customevents.EnderSignalArriveEvent((org.bukkit.entity.EnderSignal) this.getBukkitEntity()).callEvent())) {return;} // EMC
                 this.playSound(SoundEffects.ENTITY_ENDER_EYE_DEATH, 1.0F, 1.0F);
                 this.die();
                 if (this.shouldDropItem) {
diff --git a/src/main/java/org/bukkit/craftbukkit/entity/CraftBlaze.java b/src/main/java/org/bukkit/craftbukkit/entity/CraftBlaze.java
index c5800e2453e5a2ac115e2691fff2ae27698764f3..600f91db1db5864508adcf298fa8a47c6b88535d 100644
--- a/src/main/java/org/bukkit/craftbukkit/entity/CraftBlaze.java
+++ b/src/main/java/org/bukkit/craftbukkit/entity/CraftBlaze.java
@@ -24,4 +24,22 @@ public class CraftBlaze extends CraftMonster implements Blaze {
     public EntityType getType() {
         return EntityType.BLAZE;
     }
+
+    // EMC start
+    public void setFireballs(int num) {
+        getHandle().setFireballs(num);
+    }
+
+    public int getNumFireballs() {
+        return getHandle().getNumFireballs();
+    }
+
+    public int getTimeBetweenFireballs() {
+        return getHandle().getTimeBetweenFireballs();
+    }
+
+    public void setTimeBetweenFireballs(int timeBetweenFireballs) {
+        getHandle().setTimeBetweenFireballs(timeBetweenFireballs);
+    }
+    // EMC end
 }
diff --git a/src/main/java/org/bukkit/craftbukkit/entity/CraftEnderSignal.java b/src/main/java/org/bukkit/craftbukkit/entity/CraftEnderSignal.java
index d8beee82c62cf4a55f9c0075fc80ede478b733ef..9e406f94c72233e49ee86b3441e1c0a704663b6c 100644
--- a/src/main/java/org/bukkit/craftbukkit/entity/CraftEnderSignal.java
+++ b/src/main/java/org/bukkit/craftbukkit/entity/CraftEnderSignal.java
@@ -37,8 +37,9 @@ public class CraftEnderSignal extends CraftEntity implements EnderSignal {
     }
 
     @Override
-    public void setTargetLocation(Location location) {
+    public void setTargetLocation(Location location, boolean exactTarget) { // EMC
         Preconditions.checkArgument(getWorld().equals(location.getWorld()), "Cannot target EnderSignal across worlds");
+        getHandle().exactTarget = exactTarget; // EMC
         getHandle().a(new BlockPosition(location.getX(), location.getY(), location.getZ()));
     }
 
diff --git a/src/main/java/org/bukkit/craftbukkit/entity/CraftGhast.java b/src/main/java/org/bukkit/craftbukkit/entity/CraftGhast.java
index b24807364f97960e435a4ab2094255227e46d855..1815f10c0e18fea9e3700fcd998b9ecb3905997d 100644
--- a/src/main/java/org/bukkit/craftbukkit/entity/CraftGhast.java
+++ b/src/main/java/org/bukkit/craftbukkit/entity/CraftGhast.java
@@ -25,4 +25,13 @@ public class CraftGhast extends CraftFlying implements Ghast {
     public EntityType getType() {
         return EntityType.GHAST;
     }
+
+    // EMC start
+    public int getFireballCooldown() {
+        return getHandle().fireballCooldown;
+    }
+    public void setFireballCooldown(int cooldown) {
+        getHandle().fireballCooldown = cooldown;
+    }
+    // EMC end
 }
diff --git a/src/main/java/org/spigotmc/ActivationRange.java b/src/main/java/org/spigotmc/ActivationRange.java
index 5c2eaca0bc63c7880ee928aba6a24761737aa649..a625bd44b9aa9607d55a8a954e9bed9949ea04b1 100644
--- a/src/main/java/org/spigotmc/ActivationRange.java
+++ b/src/main/java/org/spigotmc/ActivationRange.java
@@ -374,6 +374,7 @@ public class ActivationRange
      */
     public static boolean checkIfActive(Entity entity)
     {
+        if (entity.isDisabled) return true; // EMC
         // Never safe to skip fireworks or entities not yet added to chunk
         if ( !entity.inChunk || entity instanceof EntityFireworks ) {
             return true;

From 08d5d2d8becaf1a72e71324a54b743835d2b47d7 Mon Sep 17 00:00:00 2001
From: Aikar <aikar@aikar.co>
Date: Mon, 11 Mar 2013 21:05:05 -0400
Subject: [PATCH] Keep certain items on death API

This adds a getItemsToKeep to PlayerDeathEvent that can be modified for what item a player should keep upon death.

This can be used for never-to-be-dropped items.
---
 src/main/java/net/minecraft/server/EntityPlayer.java | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/src/main/java/net/minecraft/server/EntityPlayer.java b/src/main/java/net/minecraft/server/EntityPlayer.java
index c164e39..30117ef 100644
--- a/src/main/java/net/minecraft/server/EntityPlayer.java
+++ b/src/main/java/net/minecraft/server/EntityPlayer.java
@@ -410,6 +410,16 @@ public class EntityPlayer extends EntityHuman implements ICrafting {
         }
 
         this.closeInventory();
+
+        // EMC start
+        final java.util.HashMap<Integer,org.bukkit.inventory.ItemStack> overflowDrops = this.getBukkitEntity().getInventory()
+              .addItem(event.getItemsToKeep().toArray(new org.bukkit.inventory.ItemStack[0]));
+        for (org.bukkit.inventory.ItemStack stack : overflowDrops.values()) {
+            if (stack == null || stack.getType() == org.bukkit.Material.AIR) continue;
+            this.world.getWorld().dropItemNaturally(this.getBukkitEntity().getLocation(), stack);
+        }
+        // EMC end
+
         // CraftBukkit end
 
         // CraftBukkit - Get our scores instead
-- 
1.8.3.2


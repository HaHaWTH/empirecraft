From 2e473e013ff63a539ac59f42d1611b22fddb4573 Mon Sep 17 00:00:00 2001
From: Aikar <aikar@aikar.co>
Date: Fri, 15 Feb 2013 20:10:44 -0500
Subject: [PATCH] Re-enable low priority queue, use on all chunk sends

---
 src/main/java/net/minecraft/server/NetworkManager.java       | 8 +++++++-
 src/main/java/net/minecraft/server/Packet56MapChunkBulk.java | 3 ++-
 2 files changed, 9 insertions(+), 2 deletions(-)

diff --git a/src/main/java/net/minecraft/server/NetworkManager.java b/src/main/java/net/minecraft/server/NetworkManager.java
index 7c64e9b..64a3295 100644
--- a/src/main/java/net/minecraft/server/NetworkManager.java
+++ b/src/main/java/net/minecraft/server/NetworkManager.java
@@ -79,7 +79,13 @@ public class NetworkManager implements INetworkManager {
 
             synchronized (this.h) {
                 this.y += packet.a() + 1;
-                this.highPriorityQueue.add(packet);
+                // EMC start - Add Low Priority Queue back
+                if (packet.lowPriority) {
+                    this.lowPriorityQueue.add(packet);
+                } else {
+                    this.highPriorityQueue.add(packet);
+                }
+                // EMC end
             }
         }
     }
diff --git a/src/main/java/net/minecraft/server/Packet56MapChunkBulk.java b/src/main/java/net/minecraft/server/Packet56MapChunkBulk.java
index 9d5cee7..db033f8 100644
--- a/src/main/java/net/minecraft/server/Packet56MapChunkBulk.java
+++ b/src/main/java/net/minecraft/server/Packet56MapChunkBulk.java
@@ -30,9 +30,10 @@ public class Packet56MapChunkBulk extends Packet {
     // CraftBukkit end
     private World world; // Spigot (Orebfuscator) Keep track of world
 
-    public Packet56MapChunkBulk() {}
+    public Packet56MapChunkBulk() {this.lowPriority=true;} // EMC - Make low priority to fix sign issues and match 51
 
     public Packet56MapChunkBulk(List list) {
+        this.lowPriority=true; // EMC - Make low priority to fix sign issues and match 51
         int i = list.size();
 
         this.c = new int[i];
-- 
1.8.1.1


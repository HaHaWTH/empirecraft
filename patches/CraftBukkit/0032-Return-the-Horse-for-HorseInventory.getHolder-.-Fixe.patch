From b883aee20e8b6235e70f7f0ade0372ef4202bd76 Mon Sep 17 00:00:00 2001
From: BlackHole <black-hole@live.com>
Date: Tue, 16 Jul 2013 23:16:18 +0200
Subject: [PATCH] Return the Horse for HorseInventory.getHolder(). Fixes
 BUKKIT-4466

---
 src/main/java/net/minecraft/server/EntityHorse.java         | 1 +
 src/main/java/net/minecraft/server/InventoryHorseChest.java | 6 +++---
 2 files changed, 4 insertions(+), 3 deletions(-)

diff --git a/src/main/java/net/minecraft/server/EntityHorse.java b/src/main/java/net/minecraft/server/EntityHorse.java
index 761ebba..fd86328 100644
--- a/src/main/java/net/minecraft/server/EntityHorse.java
+++ b/src/main/java/net/minecraft/server/EntityHorse.java
@@ -329,6 +329,7 @@ public class EntityHorse extends EntityAnimal implements IInventoryListener {
         InventoryHorseChest inventoryhorsechest = this.inventoryChest;
 
         this.inventoryChest = new InventoryHorseChest("HorseChest", this.cG());
+        this.inventoryChest.horse = (org.bukkit.entity.Horse) this.getBukkitEntity(); // CraftBukkit
         this.inventoryChest.a(this.getLocalizedName());
         if (inventoryhorsechest != null) {
             inventoryhorsechest.b(this);
diff --git a/src/main/java/net/minecraft/server/InventoryHorseChest.java b/src/main/java/net/minecraft/server/InventoryHorseChest.java
index 1fa3d5f..f58e0d2 100644
--- a/src/main/java/net/minecraft/server/InventoryHorseChest.java
+++ b/src/main/java/net/minecraft/server/InventoryHorseChest.java
@@ -14,7 +14,7 @@ public class InventoryHorseChest extends InventorySubcontainer {
 
     // CraftBukkit start
     public List<HumanEntity> transaction = new java.util.ArrayList<HumanEntity>();
-    public org.bukkit.entity.Player player;
+    public org.bukkit.entity.Horse horse;
     private int maxStack = MAX_STACK;
 
     @Override
@@ -39,7 +39,7 @@ public class InventoryHorseChest extends InventorySubcontainer {
 
     @Override
     public org.bukkit.inventory.InventoryHolder getOwner() {
-        return this.player;
+        return this.horse;
     }
 
     @Override
@@ -52,4 +52,4 @@ public class InventoryHorseChest extends InventorySubcontainer {
         return maxStack;
     }
     // CraftBukkit end
-}
\ No newline at end of file
+}
-- 
1.8.3.4


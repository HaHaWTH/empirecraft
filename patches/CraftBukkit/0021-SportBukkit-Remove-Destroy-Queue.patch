From 16be40d10c58777d4d9edb3cb87b06fa2307960d Mon Sep 17 00:00:00 2001
From: mrapple <tony@oc.tc>
Date: Mon, 17 Jun 2013 00:27:28 -0400
Subject: [PATCH] SportBukkit - Remove Destroy Queue

---
 src/main/java/net/minecraft/server/EntityPlayer.java       |  7 +++++--
 src/main/java/net/minecraft/server/EntityTrackerEntry.java | 10 +++++-----
 2 files changed, 10 insertions(+), 7 deletions(-)

diff --git a/src/main/java/net/minecraft/server/EntityPlayer.java b/src/main/java/net/minecraft/server/EntityPlayer.java
index 7c2f985..e729d2f 100644
--- a/src/main/java/net/minecraft/server/EntityPlayer.java
+++ b/src/main/java/net/minecraft/server/EntityPlayer.java
@@ -30,7 +30,7 @@ public class EntityPlayer extends EntityHuman implements ICrafting {
     public double d;
     public double e;
     public final List chunkCoordIntPairQueue = new LinkedList();
-    public final List removeQueue = new LinkedList();
+    //public final List removeQueue = new LinkedList(); // SportBukkit
     private int cm = -99999999;
     private int cn = -99999999;
     private boolean co = true;
@@ -161,6 +161,8 @@ public class EntityPlayer extends EntityHuman implements ICrafting {
         }
         // CraftBukkit end
 
+        // SportBukkit start
+        /*
         while (!this.removeQueue.isEmpty()) {
             int i = Math.min(this.removeQueue.size(), 127);
             int[] aint = new int[i];
@@ -174,6 +176,7 @@ public class EntityPlayer extends EntityHuman implements ICrafting {
 
             this.playerConnection.sendPacket(new Packet29DestroyEntity(aint));
         }
+        */ // SportBukkit end
 
         if (!this.chunkCoordIntPairQueue.isEmpty()) {
             ArrayList arraylist = new ArrayList();
@@ -737,7 +740,7 @@ public class EntityPlayer extends EntityHuman implements ICrafting {
         this.lastSentExp = -1;
         this.cm = -1;
         this.cn = -1;
-        this.removeQueue.addAll(((EntityPlayer) entityhuman).removeQueue);
+        //this.removeQueue.addAll(((EntityPlayer) entityhuman).removeQueue); // SportBukkit
     }
 
     protected void a(MobEffect mobeffect) {
diff --git a/src/main/java/net/minecraft/server/EntityTrackerEntry.java b/src/main/java/net/minecraft/server/EntityTrackerEntry.java
index 6fe65a2..0d8d5fc 100644
--- a/src/main/java/net/minecraft/server/EntityTrackerEntry.java
+++ b/src/main/java/net/minecraft/server/EntityTrackerEntry.java
@@ -274,13 +274,13 @@ public class EntityTrackerEntry {
         while (iterator.hasNext()) {
             EntityPlayer entityplayer = (EntityPlayer) iterator.next();
 
-            entityplayer.removeQueue.add(Integer.valueOf(this.tracker.id));
+            entityplayer.playerConnection.sendPacket(new Packet29DestroyEntity(this.tracker.id)); // SportBukkit
         }
     }
 
     public void a(EntityPlayer entityplayer) {
         if (this.trackedPlayers.contains(entityplayer)) {
-            entityplayer.removeQueue.add(Integer.valueOf(this.tracker.id));
+            entityplayer.playerConnection.sendPacket(new Packet29DestroyEntity(this.tracker.id)); // SportBukkit
             this.trackedPlayers.remove(entityplayer);
         }
     }
@@ -301,7 +301,7 @@ public class EntityTrackerEntry {
                         }
                     }
 
-                    entityplayer.removeQueue.remove(Integer.valueOf(this.tracker.id));
+                    entityplayer.playerConnection.sendPacket(new Packet29DestroyEntity(this.tracker.id)); // SportBukkit
                     // CraftBukkit end
 
                     this.trackedPlayers.add(entityplayer);
@@ -368,7 +368,7 @@ public class EntityTrackerEntry {
                 }
             } else if (this.trackedPlayers.contains(entityplayer)) {
                 this.trackedPlayers.remove(entityplayer);
-                entityplayer.removeQueue.add(Integer.valueOf(this.tracker.id));
+                entityplayer.playerConnection.sendPacket(new Packet29DestroyEntity(this.tracker.id)); // SportBukkit
             }
         }
     }
@@ -483,7 +483,7 @@ public class EntityTrackerEntry {
         if (Thread.currentThread() != MinecraftServer.getServer().primaryThread) throw new IllegalStateException("Asynchronous player tracker clear!"); // Spigot
         if (this.trackedPlayers.contains(entityplayer)) {
             this.trackedPlayers.remove(entityplayer);
-            entityplayer.removeQueue.add(Integer.valueOf(this.tracker.id));
+            entityplayer.playerConnection.sendPacket(new Packet29DestroyEntity(this.tracker.id)); // SportBukkit
         }
     }
 }
-- 
1.8.3.1


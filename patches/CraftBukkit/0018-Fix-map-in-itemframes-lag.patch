From 590dbfd2334a718ee08bd84211f5041747abfd2c Mon Sep 17 00:00:00 2001
From: Aikar <aikar@aikar.co>
Date: Fri, 15 Feb 2013 22:20:14 -0500
Subject: [PATCH] Fix map in itemframes lag.

---
 src/main/java/net/minecraft/server/EntityTrackerEntry.java | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/src/main/java/net/minecraft/server/EntityTrackerEntry.java b/src/main/java/net/minecraft/server/EntityTrackerEntry.java
index f42cfdf..6afbbbc 100644
--- a/src/main/java/net/minecraft/server/EntityTrackerEntry.java
+++ b/src/main/java/net/minecraft/server/EntityTrackerEntry.java
@@ -73,13 +73,13 @@ public class EntityTrackerEntry {
             this.broadcast(new Packet39AttachEntity(this.tracker, this.tracker.vehicle));
         }
 
-        if (this.tracker instanceof EntityItemFrame && this.m % 10000 == 0) {
+        if (this.tracker instanceof EntityItemFrame && this.m % 100 == 0) {
             EntityItemFrame i4 = (EntityItemFrame) this.tracker;
             ItemStack i5 = i4.i();
 
             if (i5 != null && i5.getItem() instanceof ItemWorldMap) {
                 WorldMap i7 = Item.MAP.getSavedMap(i5, this.tracker.world);
-                Iterator j0 = list.iterator();
+                Iterator j0 = this.trackedPlayers.iterator(); // CraftBukkit - Only send to players in range
 
                 while (j0.hasNext()) {
                     EntityHuman j1 = (EntityHuman) j0.next();
-- 
1.8.1.1


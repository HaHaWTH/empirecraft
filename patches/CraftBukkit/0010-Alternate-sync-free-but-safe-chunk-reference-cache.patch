From 2630898a976f23039073c2fc5a21f8c5ff463cc6 Mon Sep 17 00:00:00 2001
From: Mike Primm <mike@primmhome.com>
Date: Wed, 16 Jan 2013 20:38:22 -0500
Subject: [PATCH] Alternate, sync-free-but-safe chunk reference cache

---
 src/main/java/net/minecraft/server/World.java |   16 ++++++++--------
 1 file changed, 8 insertions(+), 8 deletions(-)

diff --git a/src/main/java/net/minecraft/server/World.java b/src/main/java/net/minecraft/server/World.java
index e0095eb..b51271e 100644
--- a/src/main/java/net/minecraft/server/World.java
+++ b/src/main/java/net/minecraft/server/World.java
@@ -300,15 +300,15 @@ public abstract class World implements IBlockAccess {
 
     // CraftBukkit start
     public Chunk getChunkAt(int i, int j) {
-        Chunk result = null;
-        synchronized (this.chunkLock) {
-            if (this.lastChunkAccessed == null || this.lastXAccessed != i || this.lastZAccessed != j) {
-                this.lastChunkAccessed = this.chunkProvider.getOrCreateChunk(i, j);
-                this.lastXAccessed = i;
-                this.lastZAccessed = j;
+        // Spigot start
+        Chunk result = this.lastChunkAccessed;
+        //synchronized (this.chunkLock) {
+            if (result == null || result.x != i || result.z != j) {
+                result = this.chunkProvider.getOrCreateChunk(i, j);
+                this.lastChunkAccessed = result;
             }
-            result = this.lastChunkAccessed;
-        }
+        //}
+        // Spigot end
         return result;
     }
     // CraftBukkit end
-- 
1.7.10.4


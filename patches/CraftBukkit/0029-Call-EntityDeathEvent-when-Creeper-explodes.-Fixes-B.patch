From 635e4a08ef18bb0d1682ba0f9dc1e3a7b611f527 Mon Sep 17 00:00:00 2001
From: T00thpick1 <t00thpick1dirko@gmail.com>
Date: Fri, 19 Jul 2013 11:17:54 -0400
Subject: [PATCH] Call EntityDeathEvent when Creeper explodes. Fixes
 BUKKIT-1812

---
 src/main/java/net/minecraft/server/EntityCreeper.java | 9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/src/main/java/net/minecraft/server/EntityCreeper.java b/src/main/java/net/minecraft/server/EntityCreeper.java
index 00c1352..807fb33 100644
--- a/src/main/java/net/minecraft/server/EntityCreeper.java
+++ b/src/main/java/net/minecraft/server/EntityCreeper.java
@@ -101,6 +101,15 @@ public class EntityCreeper extends EntityMonster {
                     if (!event.isCancelled()) {
                         this.world.createExplosion(this, this.locX, this.locY, this.locZ, event.getRadius(), event.getFire(), flag);
                         this.die();
+                        this.b = 0; // Set Exp to zero to emulate vanilla explosion death
+                        i = CraftEventFactory.callEntityDeathEvent(this).getDroppedExp();
+                        // Force drop custom set exp via event
+                        while (i > 0) {
+                            int j = EntityExperienceOrb.getOrbValue(i);
+
+                            i -= j;
+                            this.world.addEntity(new EntityExperienceOrb(this.world, this.locX, this.locY, this.locZ, j));
+                        }
                     } else {
                         this.fuseTicks = 0;
                     }
-- 
1.8.3.4


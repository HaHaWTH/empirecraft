From fd5f02a98ca25697a221191562350bef0b063893 Mon Sep 17 00:00:00 2001
From: Aikar <aikar@aikar.co>
Date: Thu, 24 Jan 2013 22:40:53 -0500
Subject: [PATCH] Ignore bed if it's in the end and returning to the wild

---
 src/main/java/net/minecraft/server/PlayerList.java | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/main/java/net/minecraft/server/PlayerList.java b/src/main/java/net/minecraft/server/PlayerList.java
index a52d0e4..22f2856 100644
--- a/src/main/java/net/minecraft/server/PlayerList.java
+++ b/src/main/java/net/minecraft/server/PlayerList.java
@@ -441,7 +441,7 @@ public abstract class PlayerList {
             if ((cause == TeleportCause.END_PORTAL) && (i == 0)) {
                 // THE_END -> NORMAL; use bed if available, otherwise default spawn
                 exit = ((CraftPlayer) entityplayer.getBukkitEntity()).getBedSpawnLocation();
-                if (exit == null) exit = exitWorld.getWorld().getSpawnLocation();
+                if (exit == null || exit.getWorld().equals(enter.getWorld())) exit = exitWorld.getWorld().getSpawnLocation();
             } else {
                 // NORMAL <-> NETHER or NORMAL -> THE_END
                 exit = this.calculateTarget(enter, exitWorld);
-- 
1.8.0.3


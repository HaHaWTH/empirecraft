From f5b2c5817b429bcbc35d75e9a30e353e062ea0ce Mon Sep 17 00:00:00 2001
From: Aikar <aikar@aikar.co>
Date: Mon, 15 Jul 2013 21:59:12 -0400
Subject: [PATCH] Prevent crash from stack overflow in doPhysics

---
 src/main/java/net/minecraft/server/World.java | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/main/java/net/minecraft/server/World.java b/src/main/java/net/minecraft/server/World.java
index 13e07f4..8193fb9 100644
--- a/src/main/java/net/minecraft/server/World.java
+++ b/src/main/java/net/minecraft/server/World.java
@@ -529,7 +529,7 @@ public abstract class World implements IBlockAccess {
                     }
                     // CraftBukkit end
 
-                    block.doPhysics(this, i, j, k, l);
+                    try {block.doPhysics(this, i, j, k, l); } catch (StackOverflowError e) { System.err.println("StackOverflow prevented on physics at: " + worldData.getName()+":"+i+","+j+","+k);} // Spigot
                 } catch (Throwable throwable) {
                     CrashReport crashreport = CrashReport.a(throwable, "Exception while updating neighbours");
                     CrashReportSystemDetails crashreportsystemdetails = crashreport.a("Block being updated");
-- 
1.8.3.4


From 7eab207536e5bf6a6a1666563ee13529360baabd Mon Sep 17 00:00:00 2001
From: Aikar <aikar@aikar.co>
Date: Mon, 11 Mar 2013 21:05:05 -0400
Subject: [PATCH] Keep certain items on death API

This adds a getItemsToKeep to PlayerDeathEvent that can be modified for what item a player should keep upon death.

This can be used for never-to-be-dropped items.
---
 src/main/java/net/minecraft/server/EntityPlayer.java | 9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/src/main/java/net/minecraft/server/EntityPlayer.java b/src/main/java/net/minecraft/server/EntityPlayer.java
index fc06e62..197b720 100644
--- a/src/main/java/net/minecraft/server/EntityPlayer.java
+++ b/src/main/java/net/minecraft/server/EntityPlayer.java
@@ -275,6 +275,15 @@ public class EntityPlayer extends EntityHuman implements ICrafting {
         }
 
         this.closeInventory();
+        // EMC start
+        final java.util.HashMap<Integer,org.bukkit.inventory.ItemStack> overflowDrops = this.getBukkitEntity().getInventory()
+              .addItem(event.getItemsToKeep().toArray(new org.bukkit.inventory.ItemStack[0]));
+        for (org.bukkit.inventory.ItemStack stack : overflowDrops.values()) {
+            if (stack == null || stack.getType() == org.bukkit.Material.AIR) continue;
+            this.world.getWorld().dropItemNaturally(this.getBukkitEntity().getLocation(), stack);
+        }
+        // EMC end
+
 
         // Update effects on player death
         this.updateEffects = true;
-- 
1.8.1.5


From 9bfcc53071f54d04ba8ac100d497c6391cfc9ca3 Mon Sep 17 00:00:00 2001
From: Aikar <aikar@aikar.co>
Date: Wed, 23 Apr 2014 23:36:17 -0400
Subject: [PATCH] Prevent null Target for TargetLivingEntity

Can throw NPE's, just cancel and set it back
---
 src/main/java/org/bukkit/craftbukkit/event/CraftEventFactory.java | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/src/main/java/org/bukkit/craftbukkit/event/CraftEventFactory.java b/src/main/java/org/bukkit/craftbukkit/event/CraftEventFactory.java
index e84d4a8..fe45a77 100644
--- a/src/main/java/org/bukkit/craftbukkit/event/CraftEventFactory.java
+++ b/src/main/java/org/bukkit/craftbukkit/event/CraftEventFactory.java
@@ -570,6 +570,12 @@ public class CraftEventFactory {
     public static EntityTargetLivingEntityEvent callEntityTargetLivingEvent(Entity entity, EntityLiving target, EntityTargetEvent.TargetReason reason) {
         EntityTargetLivingEntityEvent event = new EntityTargetLivingEntityEvent(entity.getBukkitEntity(), (LivingEntity) target.getBukkitEntity(), reason);
         entity.getBukkitEntity().getServer().getPluginManager().callEvent(event);
+        // EMC start
+        if (event.getTarget() == null) {
+            event.setCancelled(true);
+            event.setTarget(target.getBukkitEntity());
+        }
+        // EMC end
         return event;
     }
 
-- 
1.8.3.2


From 37dacf6759785c6c48e943caac0fec28d59cbd04 Mon Sep 17 00:00:00 2001
From: Aikar <aikar@aikar.co>
Date: Fri, 10 Jan 2014 19:21:31 -0500
Subject: [PATCH] Fix arrow/firework despawn timings

If Inactive tick, bump counters
---
 src/main/java/net/minecraft/server/EntityArrow.java     | 12 +++++++++++-
 src/main/java/net/minecraft/server/EntityFireworks.java |  8 ++++++++
 2 files changed, 19 insertions(+), 1 deletion(-)

diff --git a/src/main/java/net/minecraft/server/EntityArrow.java b/src/main/java/net/minecraft/server/EntityArrow.java
index 9f34a2c..1befe53 100644
--- a/src/main/java/net/minecraft/server/EntityArrow.java
+++ b/src/main/java/net/minecraft/server/EntityArrow.java
@@ -20,6 +20,16 @@ public class EntityArrow extends Entity implements IProjectile {
     public int fromPlayer;
     public int shake;
     public Entity shooter;
+    // Spigot Start
+    @Override
+    public void inactiveTick() {
+        if (this.inGround) {
+            this.at += 19;
+        }
+        super.inactiveTick();
+    }
+    // Make sure this increments the despawn counter if conflict here
+    // Spigot End
     private int at;
     private int au;
     private double damage = 2.0D;
@@ -145,7 +155,7 @@ public class EntityArrow extends Entity implements IProjectile {
 
             if (block == this.g && i == this.h) {
                 ++this.at;
-                if (this.at == world.spigotConfig.arrowDespawnRate) {
+                if (this.at >= world.spigotConfig.arrowDespawnRate) { // Spigot
                     this.die();
                 }
             } else {
diff --git a/src/main/java/net/minecraft/server/EntityFireworks.java b/src/main/java/net/minecraft/server/EntityFireworks.java
index a228a2c..7a9b479 100644
--- a/src/main/java/net/minecraft/server/EntityFireworks.java
+++ b/src/main/java/net/minecraft/server/EntityFireworks.java
@@ -5,6 +5,14 @@ public class EntityFireworks extends Entity {
     private int ticksFlown;
     public int expectedLifespan; // CraftBukkit - private -> public
 
+    // Spigot Start
+    @Override
+    public void inactiveTick() {
+        this.ticksFlown += 19;
+        super.inactiveTick();
+    }
+    // Spigot End
+
     public EntityFireworks(World world) {
         super(world);
         this.a(0.25F, 0.25F);
-- 
1.8.3.2


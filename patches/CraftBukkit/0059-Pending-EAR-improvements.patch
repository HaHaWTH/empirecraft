From f90f050d81db71e25b1a38421ff8becf1ae5f348 Mon Sep 17 00:00:00 2001
From: Aikar <aikar@aikar.co>
Date: Mon, 7 Jul 2014 21:46:39 -0400
Subject: [PATCH] Pending EAR improvements

---
 src/main/java/org/spigotmc/ActivationRange.java | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/src/main/java/org/spigotmc/ActivationRange.java b/src/main/java/org/spigotmc/ActivationRange.java
index 06284ad..e93f698 100644
--- a/src/main/java/org/spigotmc/ActivationRange.java
+++ b/src/main/java/org/spigotmc/ActivationRange.java
@@ -262,6 +262,7 @@ public class ActivationRange
      */
     public static boolean checkIfActive(Entity entity)
     {
+        if (entity instanceof EntityHuman) return true;
         SpigotTimings.checkIfActiveTimer.startTiming();
         boolean isActive = entity.activatedTick >= MinecraftServer.currentTick || entity.defaultActivationState;
 
@@ -286,7 +287,8 @@ public class ActivationRange
         int x = MathHelper.floor( entity.locX );
         int z = MathHelper.floor( entity.locZ );
         // Make sure not on edge of unloaded chunk
-        if ( isActive && !entity.world.areChunksLoaded( x, 0, z, 16 ) )
+        Chunk chunk = entity.world.getChunkIfLoaded( x >> 4, z >> 4);
+        if ( isActive && !(chunk != null && chunk.areNeighborsLoaded( 1 ) ) )
         {
             isActive = false;
         }
-- 
1.9.1


From 311dbbda11ca4187320a28316d3026cd9dc955c0 Mon Sep 17 00:00:00 2001
From: Aikar <aikar@aikar.co>
Date: Sun, 26 May 2013 21:15:56 -0400
Subject: [PATCH] Drill down detail of world - doTickRest

---
 src/main/java/net/minecraft/server/WorldServer.java  | 20 +++++++++++++++++---
 .../java/org/bukkit/craftbukkit/SpigotTimings.java   | 18 ++++++++++++++++--
 2 files changed, 33 insertions(+), 5 deletions(-)

diff --git a/src/main/java/net/minecraft/server/WorldServer.java b/src/main/java/net/minecraft/server/WorldServer.java
index b0c2c96..1b2526b 100644
--- a/src/main/java/net/minecraft/server/WorldServer.java
+++ b/src/main/java/net/minecraft/server/WorldServer.java
@@ -194,7 +194,7 @@ public class WorldServer extends World implements org.bukkit.BlockChangeDelegate
             timings.mobSpawn.stopTiming(); // Spigot
         }
         // CraftBukkit end
-        timings.doTickRest.startTiming(); // Spigot
+        timings.doChunkUnload.startTiming(); // Spigot
         this.methodProfiler.c("chunkSource");
         this.chunkProvider.unloadChunks();
         int j = this.a(1.0F);
@@ -205,22 +205,36 @@ public class WorldServer extends World implements org.bukkit.BlockChangeDelegate
 
         this.worldData.setTime(this.worldData.getTime() + 1L);
         this.worldData.setDayTime(this.worldData.getDayTime() + 1L);
+        timings.doChunkUnload.stopTiming(); // Spigot
         this.methodProfiler.c("tickPending");
+        timings.doTickPending.startTiming(); // Spigot
         this.a(false);
+        timings.doTickPending.stopTiming(); // Spigot
         this.methodProfiler.c("tickTiles");
+        timings.doTickTiles.startTiming(); // Spigot
         this.g();
+        timings.doTickTiles.stopTiming(); // Spigot
         this.methodProfiler.c("chunkMap");
+        timings.doChunkMap.startTiming(); // Spigot
         this.manager.flush();
+        timings.doChunkMap.stopTiming(); // Spigot
         this.methodProfiler.c("village");
+        timings.doVillages.startTiming(); // Spigot
         this.villages.tick();
         this.siegeManager.a();
+        timings.doVillages.stopTiming(); // Spigot
         this.methodProfiler.c("portalForcer");
+        timings.doPortalForcer.startTiming(); // Spigot
         this.P.a(this.getTime());
+        timings.doPortalForcer.stopTiming(); // Spigot
         this.methodProfiler.b();
+        timings.doSounds.startTiming(); // Spigot
         this.Z();
-
+        timings.doSounds.stopTiming(); // Spigot
+        timings.doChunkGC.startTiming(); // Spigot
         this.getWorld().processChunkGC(); // CraftBukkit
-        timings.doTickRest.stopTiming(); // Spigot
+        timings.doChunkGC.stopTiming(); // Spigot
+
     }
 
     public BiomeMeta a(EnumCreatureType enumcreaturetype, int i, int j, int k) {
diff --git a/src/main/java/org/bukkit/craftbukkit/SpigotTimings.java b/src/main/java/org/bukkit/craftbukkit/SpigotTimings.java
index c78952f..4c1a7ac 100644
--- a/src/main/java/org/bukkit/craftbukkit/SpigotTimings.java
+++ b/src/main/java/org/bukkit/craftbukkit/SpigotTimings.java
@@ -93,7 +93,14 @@ public class SpigotTimings {
      */
     public static class WorldTimingsHandler {
         public final CustomTimingsHandler mobSpawn;
-        public final CustomTimingsHandler doTickRest;
+        public final CustomTimingsHandler doChunkUnload;
+        public final CustomTimingsHandler doPortalForcer;
+        public final CustomTimingsHandler doTickPending;
+        public final CustomTimingsHandler doTickTiles;
+        public final CustomTimingsHandler doVillages;
+        public final CustomTimingsHandler doChunkMap;
+        public final CustomTimingsHandler doChunkGC;
+        public final CustomTimingsHandler doSounds;
         public final CustomTimingsHandler entityTick;
         public final CustomTimingsHandler tileEntityTick;
         public final CustomTimingsHandler tileEntityPending;
@@ -103,7 +110,14 @@ public class SpigotTimings {
             String name = server.worldData.getName() +" - ";
 
             mobSpawn = new CustomTimingsHandler(name + "mobSpawn");
-            doTickRest = new CustomTimingsHandler(name + "doTickRest");
+            doChunkUnload = new CustomTimingsHandler(name + "doChunkUnload");
+            doTickPending = new CustomTimingsHandler(name + "doTickPending");
+            doTickTiles = new CustomTimingsHandler(name + "doTickTiles");
+            doVillages = new CustomTimingsHandler(name + "doVillages");
+            doChunkMap = new CustomTimingsHandler(name + "doChunkMap");
+            doSounds = new CustomTimingsHandler(name + "doSounds");
+            doChunkGC = new CustomTimingsHandler(name + "doChunkGC");
+            doPortalForcer = new CustomTimingsHandler(name + "doPortalForcer");
             entityTick = new CustomTimingsHandler(name + "entityTick");
             tileEntityTick = new CustomTimingsHandler(name + "tileEntityTick");
             tileEntityPending = new CustomTimingsHandler(name + "tileEntityPending");
-- 
1.8.3


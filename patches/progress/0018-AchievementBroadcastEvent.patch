From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Aikar <aikar@aikar.co>
Date: Fri, 6 Dec 2013 20:54:23 -0500
Subject: [PATCH] AchievementBroadcastEvent

Used to control who sees achievement message
---
 .../net/minecraft/server/AdvancementDataPlayer.java   | 11 ++++++++++-
 1 file changed, 10 insertions(+), 1 deletion(-)

diff --git a/src/main/java/net/minecraft/server/AdvancementDataPlayer.java b/src/main/java/net/minecraft/server/AdvancementDataPlayer.java
index dfdbc028f68ced197ad179248ed3b1e9d70ba057..c54a7557844dad6de09e58ba171d79dc9c16244f 100644
--- a/src/main/java/net/minecraft/server/AdvancementDataPlayer.java
+++ b/src/main/java/net/minecraft/server/AdvancementDataPlayer.java
@@ -52,6 +52,8 @@ import net.minecraft.world.level.GameRules;
 import org.apache.logging.log4j.LogManager;
 import org.apache.logging.log4j.Logger;
 import io.papermc.paper.adventure.PaperAdventure; // Paper
+import org.bukkit.craftbukkit.entity.CraftEntity;
+import org.bukkit.entity.Player;
 
 public class AdvancementDataPlayer {
 
@@ -324,8 +326,15 @@ public class AdvancementDataPlayer {
                 advancement.d().a(this.player);
                 // Paper start - Add Adventure message to PlayerAdvancementDoneEvent
                 if (message != null && this.player.world.getGameRules().getBoolean(GameRules.ANNOUNCE_ADVANCEMENTS)) {
-                    this.e.sendMessage(PaperAdventure.asVanilla(message), ChatMessageType.SYSTEM, SystemUtils.getNullUUID());
+                    // EMC start
+                    //this.e.sendMessage(PaperAdventure.asVanilla(message), ChatMessageType.SYSTEM, SystemUtils.getNullUUID());
                     // Paper end
+                    com.empireminecraft.customevents.AchievementBroadcastEvent broadcastEvent = new com.empireminecraft.customevents.AchievementBroadcastEvent(this.player.getBukkitEntity());
+                    event.callEvent();
+                    for (Player player : broadcastEvent.getReceivers()) {
+                        ((CraftEntity) player).getHandle().sendMessage(PaperAdventure.asVanilla(message), SystemUtils.b);
+                    }
+                    // EMC end
                 }
             }
         }

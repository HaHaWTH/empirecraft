From cdc8d7c717ea829910ecffafa4da3eceff7c9140 Mon Sep 17 00:00:00 2001
From: Aikar <aikar@aikar.co>
Date: Sat, 30 Jun 2018 03:06:49 -0400
Subject: [PATCH] Detect async meta set

---
 .../java/com/empireminecraft/api/meta/MetaMap.java     | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/src/main/java/com/empireminecraft/api/meta/MetaMap.java b/src/main/java/com/empireminecraft/api/meta/MetaMap.java
index a47f0130..999d8b2e 100644
--- a/src/main/java/com/empireminecraft/api/meta/MetaMap.java
+++ b/src/main/java/com/empireminecraft/api/meta/MetaMap.java
@@ -23,6 +23,8 @@
 
 package com.empireminecraft.api.meta;
 
+import org.bukkit.Bukkit;
+
 import javax.annotation.Nonnull;
 import java.util.HashMap;
 
@@ -90,6 +92,14 @@ public class MetaMap <K extends MetaKey> extends HashMap<String, Object> {
         return put(key.key(), value);
     }
 
+    @Override
+    public Object put(String key, Object value) {
+        if (!Bukkit.isPrimaryThread()) {
+            throw new IllegalStateException("Asynchronous Meta Set");
+        }
+        return super.put(key, value);
+    }
+
     public boolean containsKey(K key) {
         return containsKey(key.key());
     }
-- 
2.18.0


From 75412b5733aaa71018eaa03ad69ecb8e4848ced7 Mon Sep 17 00:00:00 2001
From: Aikar <aikar@aikar.co>
Date: Fri, 29 Mar 2019 21:45:09 -0400
Subject: [PATCH] amend ensureServerConversions

pending paper merge, store data version on stacks
---
 src/main/java/org/bukkit/inventory/ItemStack.java | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/src/main/java/org/bukkit/inventory/ItemStack.java b/src/main/java/org/bukkit/inventory/ItemStack.java
index 68b1f6d63..d48e1cc1a 100644
--- a/src/main/java/org/bukkit/inventory/ItemStack.java
+++ b/src/main/java/org/bukkit/inventory/ItemStack.java
@@ -27,6 +27,7 @@ public class ItemStack implements Cloneable, ConfigurationSerializable {
     private int amount = 0;
     private MaterialData data = null;
     private ItemMeta meta;
+    public int dataVersion = Bukkit.getUnsafe().getDataVersion(); // Paper
 
     @Utility
     protected ItemStack() {}
@@ -584,6 +585,12 @@ public class ItemStack implements Cloneable, ConfigurationSerializable {
             }
         }
 
+        // Set damage again incase meta overwrote it
+        if (args.containsKey("damage")) {
+            result.setDurability(damage);
+        }
+
+        result.dataVersion = version; // Paper
         return result.ensureServerConversions(); // Paper
     }
 
-- 
2.21.0


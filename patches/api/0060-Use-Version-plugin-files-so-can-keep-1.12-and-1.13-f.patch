From b689d3fef9ef5cfdac81f2a79d2e3aa0fdce59f9 Mon Sep 17 00:00:00 2001
From: Aikar <aikar@aikar.co>
Date: Mon, 6 Aug 2018 23:57:34 -0400
Subject: [PATCH] Use Version plugin files so can keep 1.12 and 1.13 folders
 active

---
 .../java/org/bukkit/plugin/SimplePluginManager.java   | 11 +++++++++++
 1 file changed, 11 insertions(+)

diff --git a/src/main/java/org/bukkit/plugin/SimplePluginManager.java b/src/main/java/org/bukkit/plugin/SimplePluginManager.java
index 59c70b8a2..7289043b6 100644
--- a/src/main/java/org/bukkit/plugin/SimplePluginManager.java
+++ b/src/main/java/org/bukkit/plugin/SimplePluginManager.java
@@ -105,6 +105,7 @@ public final class SimplePluginManager implements PluginManager {
      * @return A list of all plugins loaded
      */
     public Plugin[] loadPlugins(File directory) {
+        File verDir = new File(directory, "1.13"); // EMC
         Validate.notNull(directory, "Directory cannot be null");
         Validate.isTrue(directory.isDirectory(), "Directory must be a directory");
 
@@ -122,6 +123,16 @@ public final class SimplePluginManager implements PluginManager {
 
         // This is where it figures out all possible plugins
         for (File file : directory.listFiles()) {
+            // EMC start
+            File verFile = new File(verDir, file.getName());
+            if (verFile.exists() && verFile.canRead()) {
+                file = verFile;
+            } else if (new File(directory, file.getName() + ".disabled").exists()) {
+                continue;
+            }
+            if (!file.canRead()) continue;
+            // EMC end
+
             PluginLoader loader = null;
             for (Pattern filter : filters) {
                 Matcher match = filter.matcher(file.getName());
-- 
2.21.0


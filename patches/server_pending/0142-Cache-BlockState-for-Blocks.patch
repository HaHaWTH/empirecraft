From 527689bf653b157e3876bd3226742170e8bf759e Mon Sep 17 00:00:00 2001
From: Aikar <aikar@aikar.co>
Date: Thu, 14 Jan 2016 01:16:30 -0500
Subject: [PATCH] Cache BlockState for Blocks

Improve performance for many plugins that call .getState() multiple
times for things like signs that have to "build" sign data.
---
 src/main/java/org/bukkit/craftbukkit/block/CraftBlock.java | 9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/src/main/java/org/bukkit/craftbukkit/block/CraftBlock.java b/src/main/java/org/bukkit/craftbukkit/block/CraftBlock.java
index 22a8055..65fc429 100644
--- a/src/main/java/org/bukkit/craftbukkit/block/CraftBlock.java
+++ b/src/main/java/org/bukkit/craftbukkit/block/CraftBlock.java
@@ -26,6 +26,7 @@ import org.bukkit.util.BlockVector;
 
 public class CraftBlock implements Block {
     private final CraftChunk chunk;
+    private BlockState state; // EMC
     private final int x;
     private final int y;
     private final int z;
@@ -246,7 +247,15 @@ public class CraftBlock implements Block {
         }
     }
 
+    // EMC start
     public BlockState getState() {
+        if (this.state == null) {
+            this.state = getState0();
+        }
+        return this.state;
+    }
+    private BlockState getState0() {
+        // EMC end
         Material material = getType();
 
         switch (material) {
-- 
2.7.0


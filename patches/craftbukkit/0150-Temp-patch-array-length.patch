From 663946f400c9969557e253f68e5d4a1dc3c7bc7e Mon Sep 17 00:00:00 2001
From: Aikar <aikar@aikar.co>
Date: Mon, 28 Mar 2016 18:39:30 -0400
Subject: [PATCH] Temp patch array length

---
 src/main/java/net/minecraft/server/PacketDataSerializer.java | 9 ++++++++-
 1 file changed, 8 insertions(+), 1 deletion(-)

diff --git a/src/main/java/net/minecraft/server/PacketDataSerializer.java b/src/main/java/net/minecraft/server/PacketDataSerializer.java
index 42d2bf7..eae7f12 100644
--- a/src/main/java/net/minecraft/server/PacketDataSerializer.java
+++ b/src/main/java/net/minecraft/server/PacketDataSerializer.java
@@ -46,8 +46,15 @@ public class PacketDataSerializer extends ByteBuf {
         this.writeBytes(abyte);
     }
 
+    // EMC start
     public byte[] a() {
-        byte[] abyte = new byte[this.e()];
+        return readByteArray(Short.MAX_VALUE);
+    }
+    public byte[] readByteArray(int limit) {
+        final int len = this.e();
+        if (len > limit) throw new DecoderException("The received a byte array longer than allowed " + len + " > " + limit);
+        byte[] abyte = new byte[len];
+        // EMC end
 
         this.readBytes(abyte);
         return abyte;
-- 
2.7.4


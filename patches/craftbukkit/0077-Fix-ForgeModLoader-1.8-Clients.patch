From 4fd8879f1f3b30686c74a02a8933d91b34ec5c6a Mon Sep 17 00:00:00 2001
From: Aikar <aikar@aikar.co>
Date: Wed, 31 Dec 2014 13:32:49 -0500
Subject: [PATCH] Fix ForgeModLoader 1.8 Clients

---
 src/main/java/net/minecraft/server/HandshakeListener.java | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/src/main/java/net/minecraft/server/HandshakeListener.java b/src/main/java/net/minecraft/server/HandshakeListener.java
index 7de5f76..2fc9e71 100644
--- a/src/main/java/net/minecraft/server/HandshakeListener.java
+++ b/src/main/java/net/minecraft/server/HandshakeListener.java
@@ -78,6 +78,11 @@ public class HandshakeListener implements PacketHandshakingInListener {
                     org.spigotmc.SpigotConfig.bungeeAddresses.contains(ip)) {
                     b.isProxied = true;
                     String[] split = packethandshakinginsetprotocol.b.split("\00");
+                    // EMC - Fix FML
+                    if (split.length == 6 && "FML".equals(split[1])) {
+                        split = new String[] {split[0], split[3], split[4], split[5]};
+                    }
+                    // EMC end
                     if ( split.length == 3 || split.length == 4 ) {
                         packethandshakinginsetprotocol.b = split[0];
                         b.l = new java.net.InetSocketAddress(split[1], ((java.net.InetSocketAddress) b.getSocketAddress()).getPort());
-- 
1.9.1


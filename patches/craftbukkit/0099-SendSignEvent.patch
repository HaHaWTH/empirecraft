From ea5b80c45c9f8152e1073ec2e5087e0955608739 Mon Sep 17 00:00:00 2001
From: Aikar <aikar@aikar.co>
Date: Mon, 8 Jun 2015 23:55:20 -0400
Subject: [PATCH] SendSignEvent

---
 .../customevents/SendSignEvent.java                | 48 ++++++++++++++++++++++
 .../java/net/minecraft/server/TileEntitySign.java  |  1 +
 2 files changed, 49 insertions(+)
 create mode 100644 src/main/java/com/empireminecraft/customevents/SendSignEvent.java

diff --git a/src/main/java/com/empireminecraft/customevents/SendSignEvent.java b/src/main/java/com/empireminecraft/customevents/SendSignEvent.java
new file mode 100644
index 0000000..ea82b75
--- /dev/null
+++ b/src/main/java/com/empireminecraft/customevents/SendSignEvent.java
@@ -0,0 +1,48 @@
+package com.empireminecraft.customevents;
+
+import net.minecraft.server.BlockPosition;
+import net.minecraft.server.ChatComponentText;
+import net.minecraft.server.IChatBaseComponent;
+import net.minecraft.server.World;
+import org.bukkit.block.Block;
+import org.bukkit.craftbukkit.util.CraftChatMessage;
+import org.bukkit.event.Event;
+import org.bukkit.event.HandlerList;
+
+public class SendSignEvent extends Event {
+    private final IChatBaseComponent[] lines;
+    private final String[] slines;
+    private final Block block;
+    public SendSignEvent(World world, BlockPosition position, IChatBaseComponent[] lines) {
+        this.block = world.getWorld().getBlockAt(position.getX(), position.getY(), position.getZ());
+        this.lines = lines;
+        this.slines = new String[lines.length];
+        for (int i = 0; i < lines.length; i++) {
+            slines[i] = CraftChatMessage.fromComponent(lines[i]);
+        }
+    }
+
+    public Block getBlock() {
+        return block;
+    }
+
+    public String[] getLines() {
+        return slines;
+    }
+    public void setLine(int i,  String line) {
+        slines[i] = line;
+        lines[i] = new ChatComponentText("");
+        for (IChatBaseComponent comp : CraftChatMessage.fromString(line)) {
+            lines[i].addSibling(comp);
+        }
+    }
+    private static final HandlerList handlers = new HandlerList();
+
+    public HandlerList getHandlers() {
+        return handlers;
+    }
+
+    public static HandlerList getHandlerList() {
+        return handlers;
+    }
+}
diff --git a/src/main/java/net/minecraft/server/TileEntitySign.java b/src/main/java/net/minecraft/server/TileEntitySign.java
index e68c489..d9772ff 100644
--- a/src/main/java/net/minecraft/server/TileEntitySign.java
+++ b/src/main/java/net/minecraft/server/TileEntitySign.java
@@ -109,6 +109,7 @@ public class TileEntitySign extends TileEntity {
         IChatBaseComponent[] aichatbasecomponent = new IChatBaseComponent[4];
 
         System.arraycopy(this.lines, 0, aichatbasecomponent, 0, 4);
+        new com.empireminecraft.customevents.SendSignEvent(this.world, this.getPosition(), aichatbasecomponent).callEvent(); // EMC
         return new PacketPlayOutUpdateSign(this.world, this.position, aichatbasecomponent);
     }
 
-- 
1.9.1


From 746e79159ecc989680a2f4d36c6d9ab3be7b2af6 Mon Sep 17 00:00:00 2001
From: Aikar <aikar@aikar.co>
Date: Tue, 17 Nov 2015 01:28:08 -0500
Subject: [PATCH] Fire Vehicle Events for all entities

---
 src/main/java/net/minecraft/server/Entity.java       | 10 +++++-----
 src/main/java/net/minecraft/server/EntityLiving.java |  4 ++--
 2 files changed, 7 insertions(+), 7 deletions(-)

diff --git a/src/main/java/net/minecraft/server/Entity.java b/src/main/java/net/minecraft/server/Entity.java
index 39d8711..4c67f80 100644
--- a/src/main/java/net/minecraft/server/Entity.java
+++ b/src/main/java/net/minecraft/server/Entity.java
@@ -1572,7 +1572,7 @@ public abstract class Entity implements ICommandListener {
             if (this.vehicle != null) {
                 // CraftBukkit start
                 if ((this.bukkitEntity instanceof LivingEntity) && (this.vehicle.getBukkitEntity() instanceof Vehicle)) {
-                    VehicleExitEvent event = new VehicleExitEvent((Vehicle) this.vehicle.getBukkitEntity(), (LivingEntity) this.bukkitEntity);
+                    VehicleExitEvent event = new VehicleExitEvent(this.vehicle.getBukkitEntity(), (LivingEntity) this.bukkitEntity); // EMC
                     event.reason = reason; // EMC
                     pluginManager.callEvent(event);
 
@@ -1589,11 +1589,11 @@ public abstract class Entity implements ICommandListener {
             this.vehicle = null;
         } else {
             // CraftBukkit start
-            if ((this.bukkitEntity instanceof LivingEntity) && (entity.getBukkitEntity() instanceof Vehicle) && entity.world.isChunkLoaded((int) entity.locX >> 4, (int) entity.locZ >> 4, true)) {
+            if ((this.bukkitEntity instanceof LivingEntity) /*&& (entity.getBukkitEntity() instanceof Vehicle)*/ && entity.world.isChunkLoaded((int) entity.locX >> 4, (int) entity.locZ >> 4, true)) { // EMC
                 // It's possible to move from one vehicle to another.  We need to check if they're already in a vehicle, and fire an exit event if they are.
                 VehicleExitEvent exitEvent = null;
-                if (this.vehicle != null && this.vehicle.getBukkitEntity() instanceof Vehicle) {
-                    exitEvent = new VehicleExitEvent((Vehicle) this.vehicle.getBukkitEntity(), (LivingEntity) this.bukkitEntity);
+                if (this.vehicle != null /*&& this.vehicle.getBukkitEntity() instanceof Vehicle*/) { // EMC
+                    exitEvent = new VehicleExitEvent(this.vehicle.getBukkitEntity(), (LivingEntity) this.bukkitEntity); // EMC
                     exitEvent.reason = VehicleExitEvent.DismountReason.TRANSFER; // EMC
                     pluginManager.callEvent(exitEvent);
 
@@ -1602,7 +1602,7 @@ public abstract class Entity implements ICommandListener {
                     }
                 }
 
-                VehicleEnterEvent event = new VehicleEnterEvent((Vehicle) entity.getBukkitEntity(), this.bukkitEntity);
+                VehicleEnterEvent event = new VehicleEnterEvent(entity.getBukkitEntity(), this.bukkitEntity); // EMC
                 pluginManager.callEvent(event);
 
                 // If a plugin messes with the vehicle or the vehicle's passenger
diff --git a/src/main/java/net/minecraft/server/EntityLiving.java b/src/main/java/net/minecraft/server/EntityLiving.java
index 794f9b7..0e83575 100644
--- a/src/main/java/net/minecraft/server/EntityLiving.java
+++ b/src/main/java/net/minecraft/server/EntityLiving.java
@@ -1722,8 +1722,8 @@ public abstract class EntityLiving extends Entity {
         if (this.vehicle != null && entity == null) {
             // CraftBukkit start
             Entity originalVehicle = this.vehicle;
-            if ((this.bukkitEntity instanceof LivingEntity) && (this.vehicle.getBukkitEntity() instanceof Vehicle)) {
-                VehicleExitEvent event = new VehicleExitEvent((Vehicle) this.vehicle.getBukkitEntity(), (LivingEntity) this.bukkitEntity);
+            if ((this.bukkitEntity instanceof LivingEntity)/* && (this.vehicle.getBukkitEntity() instanceof Vehicle)*/) { // EMC
+                VehicleExitEvent event = new VehicleExitEvent(this.vehicle.getBukkitEntity(), (LivingEntity) this.bukkitEntity); // EMC
                 getBukkitEntity().getServer().getPluginManager().callEvent(event);
 
                 if (event.isCancelled() || vehicle != originalVehicle) {
-- 
2.6.3


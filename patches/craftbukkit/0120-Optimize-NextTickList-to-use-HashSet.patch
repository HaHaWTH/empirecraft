From 4a07c614e080f955f19dde84750cfc948487d183 Mon Sep 17 00:00:00 2001
From: Aikar <aikar@aikar.co>
Date: Thu, 3 Sep 2015 23:07:19 -0400
Subject: [PATCH] Optimize NextTickList to use HashSet

---
 src/main/java/net/minecraft/server/WorldServer.java | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

diff --git a/src/main/java/net/minecraft/server/WorldServer.java b/src/main/java/net/minecraft/server/WorldServer.java
index 62316c9..972fc03 100644
--- a/src/main/java/net/minecraft/server/WorldServer.java
+++ b/src/main/java/net/minecraft/server/WorldServer.java
@@ -48,7 +48,7 @@ public class WorldServer extends World implements IAsyncTaskHandler {
     private WorldServer.BlockActionDataList[] S = new WorldServer.BlockActionDataList[] { new WorldServer.BlockActionDataList(null), new WorldServer.BlockActionDataList(null)};
     private int T;
     private static final List<StructurePieceTreasure> U = Lists.newArrayList(new StructurePieceTreasure[] { new StructurePieceTreasure(Items.STICK, 0, 1, 3, 10), new StructurePieceTreasure(Item.getItemOf(Blocks.PLANKS), 0, 1, 3, 10), new StructurePieceTreasure(Item.getItemOf(Blocks.LOG), 0, 1, 3, 10), new StructurePieceTreasure(Items.STONE_AXE, 0, 1, 1, 3), new StructurePieceTreasure(Items.WOODEN_AXE, 0, 1, 1, 5), new StructurePieceTreasure(Items.STONE_PICKAXE, 0, 1, 1, 3), new StructurePieceTreasure(Items.WOODEN_PICKAXE, 0, 1, 1, 5), new StructurePieceTreasure(Items.APPLE, 0, 2, 3, 5), new StructurePieceTreasure(Items.BREAD, 0, 2, 3, 3), new StructurePieceTreasure(Item.getItemOf(Blocks.LOG2), 0, 1, 3, 10)});
-    private List<NextTickListEntry> V = Lists.newArrayList();
+    private Set<NextTickListEntry> V = new java.util.HashSet(); // Spigot
 
     // CraftBukkit start
     public final int dimension;
@@ -648,7 +648,7 @@ public class WorldServer extends World implements IAsyncTaskHandler {
 
                 while (iterator.hasNext()) {
                     nextticklistentry = (NextTickListEntry) iterator.next();
-                    iterator.remove();
+                    //iterator.remove(); // Spigot
                     byte b0 = 0;
 
                     if (this.areChunksLoadedBetween(nextticklistentry.a.a(-b0, -b0, -b0), nextticklistentry.a.a(b0, b0, b0))) {
@@ -672,6 +672,7 @@ public class WorldServer extends World implements IAsyncTaskHandler {
                         this.a(nextticklistentry.a, nextticklistentry.a(), 0);
                     }
                 }
+                this.V.clear(); // Spigot
                 timings.scheduledBlocksTicking.stopTiming(); // Spigot
 
                 this.methodProfiler.b();
-- 
1.9.1


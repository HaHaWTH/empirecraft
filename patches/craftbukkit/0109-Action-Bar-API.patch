From a6cf85e0c7f4727c8caf4bcbbcee46c69f07bf3f Mon Sep 17 00:00:00 2001
From: Aikar <aikar@aikar.co>
Date: Sat, 22 Aug 2015 22:15:58 -0400
Subject: [PATCH] Action Bar API

---
 src/main/java/com/empireminecraft/cbmisc/CBMiscUtils.java    | 10 ++++++++++
 src/main/java/org/bukkit/craftbukkit/entity/CraftPlayer.java |  8 ++++++++
 2 files changed, 18 insertions(+)

diff --git a/src/main/java/com/empireminecraft/cbmisc/CBMiscUtils.java b/src/main/java/com/empireminecraft/cbmisc/CBMiscUtils.java
index 63d6fc5..46f3a69 100644
--- a/src/main/java/com/empireminecraft/cbmisc/CBMiscUtils.java
+++ b/src/main/java/com/empireminecraft/cbmisc/CBMiscUtils.java
@@ -4,6 +4,8 @@ import net.minecraft.server.DamageSource;
 import net.minecraft.server.Entity;
 import net.minecraft.server.EntityDamageSource;
 import net.minecraft.server.EntityDamageSourceIndirect;
+import net.minecraft.server.IChatBaseComponent;
+import net.minecraft.server.IChatBaseComponent.ChatSerializer;
 import org.apache.commons.lang.exception.ExceptionUtils;
 import org.bukkit.Bukkit;
 import org.bukkit.World;
@@ -12,7 +14,15 @@ import org.bukkit.entity.Projectile;
 import org.bukkit.entity.ThrownPotion;
 import org.bukkit.event.entity.EntityDamageEvent;
 
+import java.util.regex.Pattern;
+
 public class CBMiscUtils {
+    private static final Pattern REPLACE_QUOTES = Pattern.compile("\"");
+
+    public static IChatBaseComponent cmpFromMessage(String str) {
+        return ChatSerializer.a("{text:'" + REPLACE_QUOTES.matcher(str).replaceAll("\\\"") + "'}");
+    }
+
     public static EntityDamageEvent.DamageCause getCause(DamageSource source) {
         if (source.isExplosion()) {
             return EntityDamageEvent.DamageCause.BLOCK_EXPLOSION;
diff --git a/src/main/java/org/bukkit/craftbukkit/entity/CraftPlayer.java b/src/main/java/org/bukkit/craftbukkit/entity/CraftPlayer.java
index f95e8ab..5b967bb 100644
--- a/src/main/java/org/bukkit/craftbukkit/entity/CraftPlayer.java
+++ b/src/main/java/org/bukkit/craftbukkit/entity/CraftPlayer.java
@@ -162,6 +162,14 @@ public class CraftPlayer extends CraftHumanEntity implements Player {
             getHandle().playerConnection.sendPacket(new PacketPlayOutChat(component));
         }
     }
+    // EMC start
+    @Override
+    public void sendActionBar(String message) {
+        if (getHandle().playerConnection == null || message == null || message.isEmpty()) return;
+
+        getHandle().playerConnection.sendPacket(new PacketPlayOutChat(com.empireminecraft.cbmisc.CBMiscUtils.cmpFromMessage(message), (byte) 2));
+    }
+    // EMC end
 
     @Override
     public void sendMessage(String message) {
-- 
1.9.1


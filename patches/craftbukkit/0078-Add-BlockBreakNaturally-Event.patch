From 03efc72234a0738e15fbaffe1f609e921ab1dbe4 Mon Sep 17 00:00:00 2001
From: Aikar <aikar@aikar.co>
Date: Thu, 18 Dec 2014 22:48:46 -0500
Subject: [PATCH] Add BlockBreakNaturally Event

To give reliable control over all blocks dropping to world to restore custom item meta
---
 .../customevents/BlockBreakNaturallyEvent.java     | 28 ++++++++++++++++++++++
 src/main/java/net/minecraft/server/Block.java      |  1 +
 2 files changed, 29 insertions(+)
 create mode 100644 src/main/java/com/empireminecraft/customevents/BlockBreakNaturallyEvent.java

diff --git a/src/main/java/com/empireminecraft/customevents/BlockBreakNaturallyEvent.java b/src/main/java/com/empireminecraft/customevents/BlockBreakNaturallyEvent.java
new file mode 100644
index 0000000..fb6914f
--- /dev/null
+++ b/src/main/java/com/empireminecraft/customevents/BlockBreakNaturallyEvent.java
@@ -0,0 +1,28 @@
+package com.empireminecraft.customevents;
+
+import org.bukkit.Location;
+import org.bukkit.entity.Item;
+import org.bukkit.event.HandlerList;
+import org.bukkit.event.block.BlockEvent;
+
+public class BlockBreakNaturallyEvent extends BlockEvent {
+    final Item item;
+    public BlockBreakNaturallyEvent(net.minecraft.server.World world, int x, int y, int z, net.minecraft.server.EntityItem item) {
+        super(new Location(world.getWorld(), x, y, z).getBlock());
+        this.item = (Item) item.getBukkitEntity();
+    }
+
+    public Item getItem() {
+        return item;
+    }
+
+    private static final HandlerList handlers = new HandlerList();
+
+    public HandlerList getHandlers() {
+        return handlers;
+    }
+
+    public static HandlerList getHandlerList() {
+        return handlers;
+    }
+}
diff --git a/src/main/java/net/minecraft/server/Block.java b/src/main/java/net/minecraft/server/Block.java
index 66e099f..f1970c0 100644
--- a/src/main/java/net/minecraft/server/Block.java
+++ b/src/main/java/net/minecraft/server/Block.java
@@ -362,6 +362,7 @@ public class Block {
             EntityItem entityitem = new EntityItem(world, (double) blockposition.getX() + d0, (double) blockposition.getY() + d1, (double) blockposition.getZ() + d2, itemstack);
 
             entityitem.p();
+            new com.empireminecraft.customevents.BlockBreakNaturallyEvent(world, i, j, k, entityitem).callEvent(); // EMC
             world.addEntity(entityitem);
         }
     }
-- 
1.9.1


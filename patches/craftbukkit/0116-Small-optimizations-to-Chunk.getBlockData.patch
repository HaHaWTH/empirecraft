From d86a06b2474346cf192b1da334a414eedb74eacb Mon Sep 17 00:00:00 2001
From: Aikar <aikar@aikar.co>
Date: Fri, 28 Aug 2015 02:30:16 -0400
Subject: [PATCH] Small optimizations to Chunk.getBlockData

Hot method, so reduce # of instructions for the method.
---
 src/main/java/net/minecraft/server/Chunk.java | 14 ++++++++------
 1 file changed, 8 insertions(+), 6 deletions(-)

diff --git a/src/main/java/net/minecraft/server/Chunk.java b/src/main/java/net/minecraft/server/Chunk.java
index 47d510d..66e1f33 100644
--- a/src/main/java/net/minecraft/server/Chunk.java
+++ b/src/main/java/net/minecraft/server/Chunk.java
@@ -442,7 +442,7 @@ public class Chunk {
     }
 
     public IBlockData getBlockData(final BlockPosition blockposition) {
-        if (this.world.G() == WorldType.DEBUG_ALL_BLOCK_STATES) {
+        /*if (this.world.G() == WorldType.DEBUG_ALL_BLOCK_STATES) { // EMC
             IBlockData iblockdata = null;
 
             if (blockposition.getY() == 60) {
@@ -454,14 +454,16 @@ public class Chunk {
             }
 
             return iblockdata == null ? Blocks.AIR.getBlockData() : iblockdata;
-        } else {
+        } else { */ // EMC
             try {
-                if (blockposition.getY() >= 0 && blockposition.getY() >> 4 < this.sections.length) {
-                    ChunkSection chunksection = this.sections[blockposition.getY() >> 4];
+                final int y = blockposition.getY(); // EMC - replace all uses
+                final int yIndex = y >> 4; // EMC
+                if (y >= 0 && yIndex < this.sections.length) {
+                    ChunkSection chunksection = this.sections[(yIndex)];
 
                     if (chunksection != null) {
                         int i = blockposition.getX() & 15;
-                        int j = blockposition.getY() & 15;
+                        int j = y & 15;
                         int k = blockposition.getZ() & 15;
 
                         return chunksection.getType(i, j, k);
@@ -484,7 +486,7 @@ public class Chunk {
                 });
                 throw new ReportedException(crashreport);
             }
-        }
+        //} // EMC
     }
 
     private int g(int i, int j, int k) {
-- 
1.9.1


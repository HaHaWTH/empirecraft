From 1e56dd0e9fcac22b103223c531c6ed8a17d093d6 Mon Sep 17 00:00:00 2001
From: chickeneer <emcchickeneer@gmail.com>
Date: Thu, 31 Dec 2015 18:07:01 -0500
Subject: [PATCH] SPIGOT-1387: Resolve bed issues on unloaded chunks

---
 src/main/java/net/minecraft/server/EntityHuman.java | 9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/src/main/java/net/minecraft/server/EntityHuman.java b/src/main/java/net/minecraft/server/EntityHuman.java
index 1dbd1eb..80a9f07 100644
--- a/src/main/java/net/minecraft/server/EntityHuman.java
+++ b/src/main/java/net/minecraft/server/EntityHuman.java
@@ -1272,7 +1272,16 @@ public abstract class EntityHuman extends EntityLiving {
         return this.world.getType(this.bx).getBlock() == Blocks.BED;
     }
 
+    // EMC start
     public static BlockPosition getBed(World world, BlockPosition blockposition, boolean flag) {
+        boolean before = ((WorldServer) world).chunkProviderServer.forceChunkLoad;
+        ((WorldServer) world).chunkProviderServer.forceChunkLoad = true;
+        final BlockPosition result = getBed0(world, blockposition, flag);
+        ((WorldServer) world).chunkProviderServer.forceChunkLoad = before;
+        return result;
+    }
+    private static BlockPosition getBed0(World world, BlockPosition blockposition, boolean flag) {
+        // EMC end
         ((ChunkProviderServer) world.chunkProvider).getChunkAt(blockposition.getX() >> 4, blockposition.getZ() >> 4); // CraftBukkit
         Block block = world.getType(blockposition).getBlock();
 
-- 
2.6.4


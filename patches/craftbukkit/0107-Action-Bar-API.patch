From 3efdffc9f2a9f3676afad68a884db54832cd7dcf Mon Sep 17 00:00:00 2001
From: Aikar <aikar@aikar.co>
Date: Sat, 22 Aug 2015 22:15:58 -0400
Subject: [PATCH] Action Bar API

---
 src/main/java/com/empireminecraft/cbmisc/CBMiscUtils.java    | 11 ++++++++++-
 src/main/java/org/bukkit/craftbukkit/entity/CraftPlayer.java |  8 ++++++++
 2 files changed, 18 insertions(+), 1 deletion(-)

diff --git a/src/main/java/com/empireminecraft/cbmisc/CBMiscUtils.java b/src/main/java/com/empireminecraft/cbmisc/CBMiscUtils.java
index 4ab01fa..069beb8 100644
--- a/src/main/java/com/empireminecraft/cbmisc/CBMiscUtils.java
+++ b/src/main/java/com/empireminecraft/cbmisc/CBMiscUtils.java
@@ -1,7 +1,8 @@
 package com.empireminecraft.cbmisc;
 
-
 import net.minecraft.server.*;
+
+import net.minecraft.server.IChatBaseComponent.ChatSerializer;
 import org.apache.commons.lang.exception.ExceptionUtils;
 import org.bukkit.Bukkit;
 import org.bukkit.Server;
@@ -19,7 +20,15 @@ import org.bukkit.plugin.Plugin;
 import java.util.Set;
 
 
+import java.util.regex.Pattern;
+
 public class CBMiscUtils {
+    private static final Pattern REPLACE_QUOTES = Pattern.compile("\"");
+
+    public static IChatBaseComponent cmpFromMessage(String str) {
+        return ChatSerializer.a("{text:'" + REPLACE_QUOTES.matcher(str).replaceAll("\\\"") + "'}");
+    }
+
     public static EntityDamageEvent.DamageCause getCause(DamageSource source) {
         if (source.isExplosion()) {
             return EntityDamageEvent.DamageCause.BLOCK_EXPLOSION;
diff --git a/src/main/java/org/bukkit/craftbukkit/entity/CraftPlayer.java b/src/main/java/org/bukkit/craftbukkit/entity/CraftPlayer.java
index f95e8ab..5b967bb 100644
--- a/src/main/java/org/bukkit/craftbukkit/entity/CraftPlayer.java
+++ b/src/main/java/org/bukkit/craftbukkit/entity/CraftPlayer.java
@@ -162,6 +162,14 @@ public class CraftPlayer extends CraftHumanEntity implements Player {
             getHandle().playerConnection.sendPacket(new PacketPlayOutChat(component));
         }
     }
+    // EMC start
+    @Override
+    public void sendActionBar(String message) {
+        if (getHandle().playerConnection == null || message == null || message.isEmpty()) return;
+
+        getHandle().playerConnection.sendPacket(new PacketPlayOutChat(com.empireminecraft.cbmisc.CBMiscUtils.cmpFromMessage(message), (byte) 2));
+    }
+    // EMC end
 
     @Override
     public void sendMessage(String message) {
-- 
2.6.2

